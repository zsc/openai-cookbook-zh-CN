<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="../">
    <title>ç¼“å­˜æç¤ºï¼ˆPrompt cachingï¼‰é€šè¿‡ Anthropic API</title>
    <link rel="stylesheet" href="assets/style.css">
    <link rel="stylesheet" href="assets/highlight.css">
    <script src="assets/script.js" defer></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$']],
                displayMath: [['$$', '$$']],
                processEscapes: false,
                packages: {'[+]': ['noerrors', 'ams']}
            },
            options: {
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
            },
            loader: {
                load: ['[tex]/noerrors', '[tex]/ams']
            }
        };
    </script>
</head>
<body>
    <div class="container">
        <nav id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <h3>ç›®å½•</h3>
                <button id="sidebar-toggle" class="sidebar-toggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
            <div class="sidebar-search">
                <input type="text" id="sidebar-search-input" placeholder="æœç´¢..." autocomplete="off">
            </div>
            <div id="tree-container">
                <nav class="tree-nav" role="tree">
                    <div class="tree-folder " data-level="0" >
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">extended_thinking</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="extended_thinking/extended_thinking_with_tool_use_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">æ‰©å±•æ€è€ƒä¸å·¥å…·ä½¿ç”¨</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="extended_thinking/extended_thinking_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">æ‰©å±•æ€è€ƒ</span>
                        </a>
                    </div>
                </div></div>
                    <div class="tree-folder " data-level="0" >
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">finetuning</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="finetuning/finetuning_on_bedrock_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">åœ¨ Bedrock ä¸Šå¾®è°ƒ Claude 3 Haiku</span>
                        </a>
                    </div>
                </div></div>
                    <div class="tree-folder expanded" data-level="0" >
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">misc</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/batch_processing_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">æ‰¹é‡å¤„ç†æ¶ˆæ¯æ‰¹æ¬¡API</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/building_evals_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">å»ºç«‹è¯„ä¼°</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/building_moderation_filter_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">å»ºç«‹ä¸€ä¸ªå¸¦æœ‰ Claude çš„å®¡æ ¸è¿‡æ»¤å™¨</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/generate_test_cases_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">é¦–å…ˆï¼Œæˆ‘ä»¬æœ‰ `extract_variables` å‡½æ•°ï¼Œ</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/how_to_enable_json_mode_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">æç¤º Claude è·å–â€œJSON æ¨¡å¼â€</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/how_to_make_sql_queries_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">å¦‚ä½•ä½¿ç”¨ Claude è¿›è¡Œ SQL æŸ¥è¯¢</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/illustrated_responses_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Claude çš„å›¾ç¤ºåŒ–å“åº”</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/mc_qa_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">å®éªŒæ€§æµ‹è¯• Claude çš„é•¿ä¸Šä¸‹æ–‡é—®ç­”èƒ½åŠ›</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/metaprompt_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Metaprompt</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/pdf_upload_summarization_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">â€œä¸Šä¼ â€PDF åˆ° Claude API</span>
                        </a>
                    </div>
                
                    <div class="tree-item active" style="padding-left: 20px;">
                        <a href="misc/prompt_caching_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¼“å­˜æç¤ºï¼ˆPrompt cachingï¼‰é€šè¿‡ Anthropic API</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/read_web_pages_with_haiku_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ä½¿ç”¨ Claude 3 Haiku æ€»ç»“ç½‘é¡µå†…å®¹</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/sampling_past_max_tokens_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Claude ä» Claude ä¹‹å¤–çš„é‡‡æ ·å“åº”ï¼Œè¶…å‡ºæœ€å¤§ä»¤ç‰Œé™åˆ¶</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/speculative_prompt_caching_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">æŠ•æœºæ€§æç¤ºç¼“å­˜</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/using_citations_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">å¼•è¨€</span>
                        </a>
                    </div>
                </div></div>
                    <div class="tree-folder " data-level="0" >
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">multimodal</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="multimodal/best_practices_for_vision_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Untitled</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="multimodal/getting_started_with_vision_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">å¼€å§‹ä¸Šæ‰‹ - å¦‚ä½•å°†å›¾åƒä¼ é€’ç»™ Claude</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="multimodal/how_to_transcribe_text_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">å¦‚ä½•ä½¿ç”¨ Claude è½¬å½•æ–‡æ¡£</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="multimodal/reading_charts_graphs_powerpoints_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ä½¿ç”¨å›¾è¡¨å’Œå¹»ç¯ç‰‡æ”¾æ˜ </span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="multimodal/using_sub_agents_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ä½¿ç”¨ Haiku ä½œä¸ºå­ä»£ç†</span>
                        </a>
                    </div>
                </div></div>
                    <div class="tree-folder " data-level="0" >
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">patterns</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-folder " data-level="1" style="padding-left: 20px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">agents</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="patterns/agents/basic_workflows_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">é¦–å…ˆä½¿ç”¨å…·æœ‰æ€ç»´é“¾çš„LLMç¡®å®šé€‚å½“çš„è·¯ç”±</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="patterns/agents/evaluator_optimizer_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Untitled</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="patterns/agents/orchestrator_workers_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">æ­¥éª¤1ï¼šè·å–åè°ƒå™¨å“åº”</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="patterns/agents/README_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">æ„å»ºé«˜æ•ˆä»£ç†çš„é£Ÿè°±</span>
                        </a>
                    </div>
                
                    <div class="tree-folder " data-level="2" style="padding-left: 40px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">prompts</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 60px;">
                        <a href="patterns/agents/prompts/citations_agent_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Untitled</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 60px;">
                        <a href="patterns/agents/prompts/research_lead_agent_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Untitled</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 60px;">
                        <a href="patterns/agents/prompts/research_subagent_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Untitled</span>
                        </a>
                    </div>
                </div></div></div></div></div></div>
                    <div class="tree-folder " data-level="0" >
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">skills</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="skills/README_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Claude æŠ€èƒ½</span>
                        </a>
                    </div>
                
                    <div class="tree-folder " data-level="1" style="padding-left: 20px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">classification</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="skills/classification/guide_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">è®¾ç½®æˆ‘ä»¬çš„ç¯å¢ƒ</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="skills/classification/README_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Claude åˆ†ç±»æŒ‡å—</span>
                        </a>
                    </div>
                
                    <div class="tree-folder " data-level="2" style="padding-left: 40px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">evaluation</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 60px;">
                        <a href="skills/classification/evaluation/README_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ä½¿ç”¨ Promptfoo è¿›è¡Œè¯„ä¼°</span>
                        </a>
                    </div>
                </div></div></div></div>
                    <div class="tree-folder " data-level="1" style="padding-left: 20px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">contextual-embeddings</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="skills/contextual-embeddings/guide_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">å¢å¼ºæ£€ç´¢çš„RAGä¸ä¸Šä¸‹æ–‡æ£€ç´¢</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="skills/contextual-embeddings/README_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç»“åˆä¸Šä¸‹æ–‡åµŒå…¥çš„æ£€ç´¢å¢å¼ºç”Ÿæˆ</span>
                        </a>
                    </div>
                </div></div>
                    <div class="tree-folder " data-level="1" style="padding-left: 20px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">retrieval_augmented_generation</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="skills/retrieval_augmented_generation/guide_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Retrieval Augmented Generation (RAG)</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="skills/retrieval_augmented_generation/README_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Untitled</span>
                        </a>
                    </div>
                
                    <div class="tree-folder " data-level="2" style="padding-left: 40px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">evaluation</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 60px;">
                        <a href="skills/retrieval_augmented_generation/evaluation/README_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ä½¿ç”¨ Promptfoo è¿›è¡Œè¯„ä¼°</span>
                        </a>
                    </div>
                </div></div></div></div>
                    <div class="tree-folder " data-level="1" style="padding-left: 20px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">summarization</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="skills/summarization/guide_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">æ‘˜è¦ä¸ Claude</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="skills/summarization/README_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Claude æ‘˜è¦</span>
                        </a>
                    </div>
                
                    <div class="tree-folder " data-level="2" style="padding-left: 40px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">evaluation</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 60px;">
                        <a href="skills/summarization/evaluation/README_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Promptfoo è¯„ä¼°</span>
                        </a>
                    </div>
                </div></div></div></div>
                    <div class="tree-folder " data-level="1" style="padding-left: 20px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">text_to_sql</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="skills/text_to_sql/guide_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Set your Anthropic API key</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="skills/text_to_sql/README_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Claude çš„æ–‡æœ¬åˆ° SQL</span>
                        </a>
                    </div>
                
                    <div class="tree-folder " data-level="2" style="padding-left: 40px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">evaluation</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 60px;">
                        <a href="skills/text_to_sql/evaluation/README_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Promptfoo è¯„ä¼°</span>
                        </a>
                    </div>
                </div></div></div></div></div></div>
                    <div class="tree-folder " data-level="0" >
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">third_party</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-folder " data-level="1" style="padding-left: 20px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">Deepgram</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/Deepgram/prerecorded_audio_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">è½¬å½•æ·±è“éŸ³é¢‘æ–‡ä»¶å¹¶ä½¿ç”¨ Anthropic å‡†å¤‡é¢è¯•é—®é¢˜ï¼</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/Deepgram/README_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Deepgram <> Anthropic Cookbooks</span>
                        </a>
                    </div>
                </div></div>
                    <div class="tree-folder " data-level="1" style="padding-left: 20px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">LlamaIndex</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/LlamaIndex/Basic_RAG_With_LlamaIndex_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">RAG ç®¡é“ä¸ LlamaIndex</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/LlamaIndex/Multi_Document_Agents_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">å¤šæ–‡æ¡£ä»£ç†</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/LlamaIndex/Multi_Modal_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">å¤šæ¨¡æ€</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/LlamaIndex/ReAct_Agent_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ReAct Agent</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/LlamaIndex/README_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">LlamaIndex <> Anthropic Cookbooks</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/LlamaIndex/Router_Query_Engine_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">æ³¨æ„ï¼šè¿™ä»…åœ¨ jupyter notebook ä¸­æ˜¯å¿…éœ€çš„ã€‚</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/LlamaIndex/SubQuestion_Query_Engine_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">SubQuestionQueryEngine</span>
                        </a>
                    </div>
                </div></div>
                    <div class="tree-folder " data-level="1" style="padding-left: 20px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">MongoDB</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/MongoDB/rag_using_mongodb_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">å¦‚ä½•ä½¿ç”¨ Claude 3 å’Œ MongoDB æ„å»º RAG ç³»ç»Ÿ</span>
                        </a>
                    </div>
                </div></div>
                    <div class="tree-folder " data-level="1" style="padding-left: 20px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">Pinecone</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/Pinecone/claude_3_rag_agent_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">æ£€æŸ¥ Python ç‰ˆæœ¬</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/Pinecone/rag_using_pinecone_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ä½¿ç”¨ Pinecone è¿›è¡Œæ£€ç´¢å¢å¼ºç”Ÿæˆ</span>
                        </a>
                    </div>
                </div></div>
                    <div class="tree-folder " data-level="1" style="padding-left: 20px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">VoyageAI</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/VoyageAI/how_to_create_embeddings_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">è¿™å°†è‡ªåŠ¨ä½¿ç”¨ç¯å¢ƒå˜é‡VOYAGE_API_KEYã€‚</span>
                        </a>
                    </div>
                </div></div>
                    <div class="tree-folder " data-level="1" style="padding-left: 20px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">Wikipedia</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/Wikipedia/wikipedia-search-cookbook_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">è¿­ä»£æœç´¢ç»´åŸºç™¾ç§‘ä¸ Claude</span>
                        </a>
                    </div>
                </div></div>
                    <div class="tree-folder " data-level="1" style="padding-left: 20px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">WolframAlpha</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/WolframAlpha/using_llm_api_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ä½¿ç”¨ Wolfram Alpha LLM API ä½œä¸º Claude çš„å·¥å…·</span>
                        </a>
                    </div>
                </div></div></div></div>
                    <div class="tree-folder " data-level="0" >
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">tool_use</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="tool_use/calculator_tool_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ä½¿ç”¨è®¡ç®—å™¨å·¥å…·ä¸ Claude</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="tool_use/customer_service_agent_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ä½¿ç”¨å®¢æˆ·ç«¯å·¥å…·åˆ›å»ºå®¢æœä»£ç†</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="tool_use/extracting_structured_json_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ä½¿ç”¨ Claude å’Œå·¥å…·ä½¿ç”¨åŠŸèƒ½æå–ç»“æ„åŒ– JSON</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="tool_use/memory_cookbook_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">å®‰è£…ä¾èµ–</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="tool_use/parallel_tools_claude_3_7_sonnet_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">åœ¨ Claude 3.7 Sonnet ä¸Šå¹¶è¡Œè°ƒç”¨å·¥å…·</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="tool_use/tool_choice_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">é€‰æ‹©å·¥å…·</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="tool_use/tool_use_with_pydantic_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">è®°äº‹å·¥å…·ï¼Œæ”¯æŒ Pydantic å’Œ Anthropic å·¥å…·ä½¿ç”¨</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="tool_use/vision_with_tools_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ä½¿ç”¨ Vision ä¸å·¥å…·</span>
                        </a>
                    </div>
                </div></div></nav>
            </div>
        </nav>
        
        <main class="content">
            <article>
                <h1 id="prompt-caching-anthropic-api">ç¼“å­˜æç¤ºï¼ˆPrompt cachingï¼‰é€šè¿‡ Anthropic API</h1>
<p>æç¤ºç¼“å­˜å…è®¸æ‚¨å­˜å‚¨å’Œé‡ç”¨æç¤ºä¸­çš„ä¸Šä¸‹æ–‡ã€‚è¿™ä½¿å¾—åœ¨æç¤ºä¸­åŒ…å«é¢å¤–ä¿¡æ¯æ›´åŠ å®ç”¨ï¼Œä¾‹å¦‚è¯¦ç»†çš„è¯´æ˜å’Œç¤ºä¾‹å“åº”ï¼Œè¿™äº›ä¿¡æ¯æœ‰åŠ©äºæ”¹è¿› Claude ç”Ÿæˆçš„æ¯ä¸ªå“åº”ã€‚</p>
<p>æ­¤å¤–ï¼Œé€šè¿‡åœ¨æç¤ºä¸­å……åˆ†åˆ©ç”¨æç¤ºç¼“å­˜ï¼Œæ‚¨å¯ä»¥å°†å»¶è¿Ÿæ—¶é—´ç¼©çŸ­ä¸€å€ä»¥ä¸Šï¼Œå¹¶å°†æˆæœ¬é™ä½é«˜è¾¾ 90%ã€‚åœ¨æ„å»ºæ¶‰åŠè¯¦ç»†ä¹¦ç±å†…å®¹çš„é‡å¤ä»»åŠ¡çš„è§£å†³æ–¹æ¡ˆæ—¶ï¼Œè¿™å¯ä»¥èŠ‚çœå¤§é‡æˆæœ¬ã€‚</p>
<p>åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæˆ‘ä»¬å°†æ¼”ç¤ºå¦‚ä½•åœ¨å•æ¬¡äº¤äº’å’Œå¤šè½®å¯¹è¯ä¸­ä½¿ç”¨æç¤ºç¼“å­˜ã€‚</p>
<h2 id="_1">è®¾ç½®</h2>
<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬è®¾ç½®å¥½ç¯å¢ƒï¼Œè¿›è¡Œå¿…è¦çš„å¯¼å…¥å’Œåˆå§‹åŒ–ï¼š</p>
<pre class="codehilite"><code class="language-python">%pip install anthropic bs4 --quiet
</code></pre>

<pre class="codehilite"><code>æ³¨æ„ï¼šæ‚¨å¯èƒ½éœ€è¦é‡å¯å†…æ ¸æ‰èƒ½ä½¿ç”¨æ›´æ–°çš„è½¯ä»¶åŒ…ã€‚
</code></pre>

<pre class="codehilite"><code class="language-python">import anthropic
import time
import requests
from bs4 import BeautifulSoup

client = anthropic.Anthropic()
MODEL_NAME = &quot;claude-3-5-sonnet-20241022&quot;
</code></pre>

<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬è·å–ä¸€äº›æ–‡æœ¬å†…å®¹ä»¥ä¾›ç¤ºä¾‹ä½¿ç”¨ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ç®€Â·å¥¥æ–¯æ±€çš„ã€Šå‚²æ…¢ä¸åè§ã€‹ä¸­çš„æ–‡æœ¬ï¼Œè¯¥æ–‡æœ¬çº¦æœ‰ 187,000 ä¸ª tokenã€‚</p>
<pre class="codehilite"><code class="language-python">def fetch_article_content(url):
    response = requests.get(url)
    soup = BeautifulSoup(response.content, 'html.parser')

    # åˆ é™¤ script å’Œ style å…ƒç´ 
    for script in soup([&quot;script&quot;, &quot;style&quot;]):
        script.decompose()

    # è·å–æ–‡æœ¬
    text = soup.get_text()

    # æŒ‰è¡Œæ‹†åˆ†å¹¶å»é™¤æ¯è¡Œé¦–å°¾çš„ç©ºæ ¼
    lines = (line.strip() for line in text.splitlines())
    # å°†å¤šè¡Œæ ‡é¢˜æ‹†åˆ†ä¸ºå•ç‹¬çš„è¡Œ
    chunks = (phrase.strip() for line in lines for phrase in line.split(&quot;  &quot;))
    # åˆ é™¤ç©ºè¡Œ
    text = '\n'.join(chunk for chunk in chunks if chunk)

    return text

# è·å–æ–‡ç« å†…å®¹
book_url = &quot;https://www.gutenberg.org/cache/epub/1342/pg1342.txt&quot;
book_content = fetch_article_content(book_url)

print(f&quot;å·²è·å– {len(book_content)} ä¸ªå­—ç¬¦ã€‚&quot;)
print(&quot;å‰ 500 ä¸ªå­—ç¬¦ï¼š&quot;)
print(book_content[:500])
</code></pre>

<pre class="codehilite"><code>å·²è·å– 737525 ä¸ªå­—ç¬¦ã€‚
å‰ 500 ä¸ªå­—ç¬¦ï¼š
The Project Gutenberg eBook of Pride and Prejudice
This ebook is for the use of anyone anywhere in the United States and
most other parts of the world at no cost and with almost no restrictions
whatsoever. You may copy it, give it away or re-use it under the terms
of the Project Gutenberg License included with this ebook or online
at www.gutenberg.org. If you are not located in the United States,
you will have to check the laws of the country where you are located
before using this eBook.
Title:
</code></pre>

<h2 id="1">ç¤ºä¾‹ 1ï¼šå•æ¬¡äº¤äº’</h2>
<p>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå¤§å‹æ–‡æ¡£æ¥æ¼”ç¤ºæç¤ºç¼“å­˜ï¼Œæ¯”è¾ƒç¼“å­˜å’Œéç¼“å­˜ API è°ƒç”¨çš„æ€§èƒ½å’Œæˆæœ¬ã€‚</p>
<h3 id="1-api">ç¬¬ 1 éƒ¨åˆ†ï¼šéç¼“å­˜ API è°ƒç”¨</h3>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬è¿›è¡Œä¸€æ¬¡éç¼“å­˜ API è°ƒç”¨ã€‚è¿™å°†æŠŠæç¤ºåŠ è½½åˆ°ç¼“å­˜ä¸­ï¼Œä»¥ä¾¿æˆ‘ä»¬åç»­çš„ç¼“å­˜ API è°ƒç”¨å¯ä»¥ä»æç¤ºç¼“å­˜ä¸­å—ç›Šã€‚</p>
<p>æˆ‘ä»¬å°†è¦æ±‚ä¸€ä¸ªç®€çŸ­çš„è¾“å‡ºå­—ç¬¦ä¸²ä»¥ä¿æŒè¾ƒä½çš„è¾“å‡ºå“åº”æ—¶é—´ï¼Œå› ä¸ºæç¤ºç¼“å­˜çš„å¥½å¤„ä»…é€‚ç”¨äºè¾“å…¥å¤„ç†æ—¶é—´ã€‚</p>
<pre class="codehilite"><code class="language-python">def make_non_cached_api_call():
    messages = [
        {
            &quot;role&quot;: &quot;user&quot;,
            &quot;content&quot;: [
                {
                    &quot;type&quot;: &quot;text&quot;,
                    &quot;text&quot;: &quot;&lt;book&gt;&quot; + book_content + &quot;&lt;/book&gt;&quot;,
                    &quot;cache_control&quot;: {&quot;type&quot;: &quot;ephemeral&quot;}
                },
                {
                    &quot;type&quot;: &quot;text&quot;,
                    &quot;text&quot;: &quot;è¿™æœ¬ä¹¦çš„æ ‡é¢˜æ˜¯ä»€ä¹ˆï¼Ÿåªè¾“å‡ºæ ‡é¢˜ã€‚&quot;
                }
            ]
        }
    ]

    start_time = time.time()
    response = client.messages.create(
        model=MODEL_NAME,
        max_tokens=300,
        messages=messages,
        extra_headers={&quot;anthropic-beta&quot;: &quot;prompt-caching-2024-07-31&quot;}

    )
    end_time = time.time()

    return response, end_time - start_time

non_cached_response, non_cached_time = make_non_cached_api_call()

print(f&quot;éç¼“å­˜ API è°ƒç”¨æ—¶é—´ï¼š{non_cached_time:.2f} ç§’&quot;)
print(f&quot;éç¼“å­˜ API è°ƒç”¨è¾“å…¥ tokenï¼š{non_cached_response.usage.input_tokens}&quot;)
print(f&quot;éç¼“å­˜ API è°ƒç”¨è¾“å‡º tokenï¼š{non_cached_response.usage.output_tokens}&quot;)

print(&quot;\næ‘˜è¦ï¼ˆéç¼“å­˜ï¼‰ï¼š&quot;)
print(non_cached_response.content)
</code></pre>

<pre class="codehilite"><code>éç¼“å­˜ API è°ƒç”¨æ—¶é—´ï¼š20.37 ç§’
éç¼“å­˜ API è°ƒç”¨è¾“å…¥ tokenï¼š17
éç¼“å­˜ API è°ƒç”¨è¾“å‡º tokenï¼š8

æ‘˜è¦ï¼ˆéç¼“å­˜ï¼‰ï¼š
[TextBlock(text='Pride and Prejudice', type='text')]
</code></pre>

<h3 id="2-api">ç¬¬ 2 éƒ¨åˆ†ï¼šç¼“å­˜ API è°ƒç”¨</h3>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬è¿›è¡Œä¸€æ¬¡ç¼“å­˜ API è°ƒç”¨ã€‚æˆ‘å°†åœ¨ content å¯¹è±¡ä¸­æ·»åŠ  "cache_control": {"type": "ephemeral"} å±æ€§ï¼Œå¹¶åœ¨è¯·æ±‚ä¸­æ·»åŠ  "prompt-caching-2024-07-31" beta æ ‡å¤´ã€‚è¿™å°†ä¸ºæ­¤æ¬¡ API è°ƒç”¨å¯ç”¨æç¤ºç¼“å­˜ã€‚</p>
<p>ä¸ºäº†ä¿æŒè¾“å‡ºå»¶è¿Ÿæ’å®šï¼Œæˆ‘ä»¬å°†å‘ Claude æå‡ºä¸ä¹‹å‰ç›¸åŒçš„é—®é¢˜ã€‚è¯·æ³¨æ„ï¼Œæ­¤é—®é¢˜ä¸å±äºç¼“å­˜å†…å®¹ã€‚</p>
<pre class="codehilite"><code class="language-python">def make_cached_api_call():
    messages = [
        {
            &quot;role&quot;: &quot;user&quot;,
            &quot;content&quot;: [
                {
                    &quot;type&quot;: &quot;text&quot;,
                    &quot;text&quot;: &quot;&lt;book&gt;&quot; + book_content + &quot;&lt;/book&gt;&quot;,
                    &quot;cache_control&quot;: {&quot;type&quot;: &quot;ephemeral&quot;}
                },
                {
                    &quot;type&quot;: &quot;text&quot;,
                    &quot;text&quot;: &quot;è¿™æœ¬ä¹¦çš„æ ‡é¢˜æ˜¯ä»€ä¹ˆï¼Ÿåªè¾“å‡ºæ ‡é¢˜ã€‚&quot;
                }
            ]
        }
    ]

    start_time = time.time()
    response = client.messages.create(
        model=MODEL_NAME,
        max_tokens=300,
        messages=messages,
        extra_headers={&quot;anthropic-beta&quot;: &quot;prompt-caching-2024-07-31&quot;}
    )
    end_time = time.time()

    return response, end_time - start_time

cached_response, cached_time = make_cached_api_call()

print(f&quot;ç¼“å­˜ API è°ƒç”¨æ—¶é—´ï¼š{cached_time:.2f} ç§’&quot;)
print(f&quot;ç¼“å­˜ API è°ƒç”¨è¾“å…¥ tokenï¼š{cached_response.usage.input_tokens}&quot;)
print(f&quot;ç¼“å­˜ API è°ƒç”¨è¾“å‡º tokenï¼š{cached_response.usage.output_tokens}&quot;)

print(&quot;\næ‘˜è¦ï¼ˆç¼“å­˜ï¼‰ï¼š&quot;)
print(cached_response.content)
</code></pre>

<pre class="codehilite"><code>ç¼“å­˜ API è°ƒç”¨æ—¶é—´ï¼š2.92 ç§’
ç¼“å­˜ API è°ƒç”¨è¾“å…¥ tokenï¼š17
ç¼“å­˜ API è°ƒç”¨è¾“å‡º tokenï¼š8

æ‘˜è¦ï¼ˆç¼“å­˜ï¼‰ï¼š
[TextBlock(text='Pride and Prejudice', type='text')]
</code></pre>

<p>å¦‚æ‚¨æ‰€è§ï¼Œç¼“å­˜ API è°ƒç”¨çš„æ€»æ—¶é—´ä»…ä¸º 3.64 ç§’ï¼Œè€Œéç¼“å­˜ API è°ƒç”¨ä¸º 21.44 ç§’ã€‚ç”±äºç¼“å­˜ï¼Œæ•´ä½“å»¶è¿Ÿæœ‰äº†æ˜¾è‘—æ”¹å–„ã€‚</p>
<h2 id="2">ç¤ºä¾‹ 2ï¼šå¸¦å¢é‡ç¼“å­˜çš„å¤šè½®å¯¹è¯</h2>
<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå¤šè½®å¯¹è¯ï¼Œåœ¨å¯¹è¯è¿›è¡Œè¿‡ç¨‹ä¸­æ·»åŠ ç¼“å­˜æ–­ç‚¹ã€‚</p>
<pre class="codehilite"><code class="language-python">class ConversationHistory:
    def __init__(self):
        # åˆå§‹åŒ–ä¸€ä¸ªç©ºåˆ—è¡¨æ¥å­˜å‚¨å¯¹è¯è½®æ¬¡
        self.turns = []

    def add_turn_assistant(self, content):
        # å°†åŠ©æ‰‹çš„è½®æ¬¡æ·»åŠ åˆ°å¯¹è¯å†å²è®°å½•ä¸­
        self.turns.append({
            &quot;role&quot;: &quot;assistant&quot;,
            &quot;content&quot;: [
                {
                    &quot;type&quot;: &quot;text&quot;,
                    &quot;text&quot;: content
                }
            ]
        })

    def add_turn_user(self, content):
        # å°†ç”¨æˆ·çš„è½®æ¬¡æ·»åŠ åˆ°å¯¹è¯å†å²è®°å½•ä¸­
        self.turns.append({
            &quot;role&quot;: &quot;user&quot;,
            &quot;content&quot;: [
                {
                    &quot;type&quot;: &quot;text&quot;,
                    &quot;text&quot;: content
                }
            ]
        })

    def get_turns(self):
        # ä»¥ç‰¹å®šæ ¼å¼æ£€ç´¢å¯¹è¯è½®æ¬¡
        result = []
        user_turns_processed = 0
        # åå‘è¿­ä»£è½®æ¬¡
        for turn in reversed(self.turns):
            if turn[&quot;role&quot;] == &quot;user&quot; and user_turns_processed &lt; 1:
                # æ·»åŠ æœ€åä¸€ä¸ªç”¨æˆ·è½®æ¬¡ï¼Œå¹¶è®¾ç½®ä¸´æ—¶ç¼“å­˜æ§åˆ¶
                result.append({
                    &quot;role&quot;: &quot;user&quot;,
                    &quot;content&quot;: [
                        {
                            &quot;type&quot;: &quot;text&quot;,
                            &quot;text&quot;: turn[&quot;content&quot;][0][&quot;text&quot;],
                            &quot;cache_control&quot;: {&quot;type&quot;: &quot;ephemeral&quot;}
                        }
                    ]
                })
                user_turns_processed += 1
            else:
                # æŒ‰åŸæ ·æ·»åŠ å…¶ä»–è½®æ¬¡
                result.append(turn)
        # æŒ‰åŸå§‹é¡ºåºè¿”å›è½®æ¬¡
        return list(reversed(result))

# åˆå§‹åŒ–å¯¹è¯å†å²è®°å½•
conversation_history = ConversationHistory()

# åŒ…å«ä¹¦ç±å†…å®¹çš„ç³»ç»Ÿæ¶ˆæ¯
# æ³¨æ„ï¼š'book_content' åº”åœ¨ä»£ç çš„å…¶ä»–åœ°æ–¹å®šä¹‰
system_message = f&quot;&lt;file_contents&gt; {book_content} &lt;/file_contents&gt;&quot;

# æˆ‘ä»¬æ¨¡æ‹Ÿçš„é¢„å®šä¹‰é—®é¢˜
questions = [
    &quot;è¿™éƒ¨å°è¯´çš„æ ‡é¢˜æ˜¯ä»€ä¹ˆï¼Ÿ&quot;,
    &quot;æœ¬å†…ç‰¹å…ˆç”Ÿå’Œæœ¬å†…ç‰¹å¤ªå¤ªæ˜¯è°ï¼Ÿ&quot;,
    &quot;ä»€ä¹ˆæ˜¯å†…ç‘Ÿè²å°”å¾·å…¬å›­ï¼Ÿ&quot;,
    &quot;è¿™éƒ¨å°è¯´çš„ä¸»é¢˜æ˜¯ä»€ä¹ˆï¼Ÿ&quot;
]

def simulate_conversation():
    for i, question in enumerate(questions, 1):
        print(f&quot;\nç¬¬ {i} è½®ï¼š&quot;)
        print(f&quot;ç”¨æˆ·ï¼š{question}&quot;)

        # å°†ç”¨æˆ·è¾“å…¥æ·»åŠ åˆ°å¯¹è¯å†å²è®°å½•ä¸­
        conversation_history.add_turn_user(question)

        # è®°å½•å¼€å§‹æ—¶é—´ä»¥è¿›è¡Œæ€§èƒ½æµ‹é‡
        start_time = time.time()

        # å‘åŠ©æ‰‹å‘å‡º API è°ƒç”¨
        response = client.messages.create(
            model=MODEL_NAME,
            extra_headers={
              &quot;anthropic-beta&quot;: &quot;prompt-caching-2024-07-31&quot;
            },
            max_tokens=300,
            system=[
                {&quot;type&quot;: &quot;text&quot;, &quot;text&quot;: system_message, &quot;cache_control&quot;: {&quot;type&quot;: &quot;ephemeral&quot;}},
            ],
            messages=conversation_history.get_turns(),
        )

        # è®°å½•ç»“æŸæ—¶é—´
        end_time = time.time()

        # æå–åŠ©æ‰‹çš„å›å¤
        assistant_reply = response.content[0].text
        print(f&quot;åŠ©æ‰‹ï¼š{assistant_reply}&quot;)

        # æ‰“å° token ä½¿ç”¨ä¿¡æ¯
        input_tokens = response.usage.input_tokens
        output_tokens = response.usage.output_tokens
        input_tokens_cache_read = getattr(response.usage, 'cache_read_input_tokens', '---')
        input_tokens_cache_create = getattr(response.usage, 'cache_creation_input_tokens', '---')
        print(f&quot;ç”¨æˆ·è¾“å…¥ tokenï¼š{input_tokens}&quot;)
        print(f&quot;è¾“å‡º tokenï¼š{output_tokens}&quot;)
        print(f&quot;è¾“å…¥ tokenï¼ˆç¼“å­˜è¯»å–ï¼‰ï¼š{input_tokens_cache_read}&quot;)
        print(f&quot;è¾“å…¥ tokenï¼ˆç¼“å­˜å†™å…¥ï¼‰ï¼š{input_tokens_cache_create}&quot;)

        # è®¡ç®—å¹¶æ‰“å°ç»è¿‡çš„æ—¶é—´
        elapsed_time = end_time - start_time

        # è®¡ç®—ç¼“å­˜çš„è¾“å…¥æç¤ºçš„ç™¾åˆ†æ¯”
        total_input_tokens = input_tokens + (int(input_tokens_cache_read) if input_tokens_cache_read != '---' else 0)
        percentage_cached = (int(input_tokens_cache_read) / total_input_tokens * 100 if input_tokens_cache_read != '---' and total_input_tokens &gt; 0 else 0)

        print(f&quot;{percentage_cached:.1f}% çš„è¾“å…¥æç¤ºå·²ç¼“å­˜ï¼ˆ{total_input_tokens} ä¸ª tokenï¼‰&quot;)
        print(f&quot;è€—æ—¶ï¼š{elapsed_time:.2f} ç§’&quot;)

        # å°†åŠ©æ‰‹çš„å›å¤æ·»åŠ åˆ°å¯¹è¯å†å²è®°å½•ä¸­
        conversation_history.add_turn_assistant(assistant_reply)

# è¿è¡Œæ¨¡æ‹Ÿå¯¹è¯
simulate_conversation()
</code></pre>

<pre class="codehilite"><code>ç¬¬ 1 è½®ï¼š
ç”¨æˆ·ï¼šè¿™éƒ¨å°è¯´çš„æ ‡é¢˜æ˜¯ä»€ä¹ˆï¼Ÿ
åŠ©æ‰‹ï¼šè¿™éƒ¨å°è¯´çš„æ ‡é¢˜æ˜¯ç®€Â·å¥¥æ–¯æ±€çš„ã€Šå‚²æ…¢ä¸åè§ã€‹ã€‚
ç”¨æˆ·è¾“å…¥ tokenï¼š4
è¾“å‡º tokenï¼š22
è¾“å…¥ tokenï¼ˆç¼“å­˜è¯»å–ï¼‰ï¼š0
è¾“å…¥ tokenï¼ˆç¼“å­˜å†™å…¥ï¼‰ï¼š187354
0.0% çš„è¾“å…¥æç¤ºå·²ç¼“å­˜ï¼ˆ4 ä¸ª tokenï¼‰
è€—æ—¶ï¼š20.37 ç§’

ç¬¬ 2 è½®ï¼š
ç”¨æˆ·ï¼šæœ¬å†…ç‰¹å…ˆç”Ÿå’Œæœ¬å†…ç‰¹å¤ªå¤ªæ˜¯è°ï¼Ÿ
åŠ©æ‰‹ï¼šæœ¬å†…ç‰¹å…ˆç”Ÿå’Œæœ¬å†…ç‰¹å¤ªå¤ªæ˜¯ã€Šå‚²æ…¢ä¸åè§ã€‹ä¸­äº”ä¸ªå¥³å„¿ï¼ˆç®€ã€ä¼Šä¸½èç™½ã€ç›ä¸½ã€å‡¯è’‚å’Œè‰è¿ªäºšï¼‰çš„çˆ¶æ¯ã€‚

æœ¬å†…ç‰¹å…ˆç”Ÿæ˜¯ä¸€ä½èªæ˜ä½†ç–ç¦»çš„çˆ¶äº²ï¼Œä»–ç»å¸¸èº²è¿›ä¹¦æˆ¿ä»¥é¿å¼€å¦»å­çš„æˆå‰§åŒ–è¡Œä¸ºã€‚ä»–å…·æœ‰è®½åˆºçš„å¹½é»˜æ„Ÿï¼Œå¹¶ä¸”å¸¸å¸¸å¯¹åŒ…æ‹¬è‡ªå·±å®¶äººåœ¨å†…çš„ä»–äººçš„æ„šè ¢è¡Œä¸ºæ„Ÿåˆ°å¥½ç¬‘ã€‚ä»–å¯¹ä»–çš„ç¬¬äºŒä¸ªå¥³å„¿ä¼Šä¸½èç™½å°¤å…¶å–œçˆ±ï¼Œä¼Šä¸½èç™½ä¹Ÿå’Œä»–ä¸€æ ·å¤´è„‘æ•é”ã€å¹½é»˜é£è¶£ã€‚

æœ¬å†…ç‰¹å¤ªå¤ªæ˜¯ä¸€ä½ä¸»è¦ä¸“æ³¨äºå°†å¥¹çš„äº”ä¸ªå¥³å„¿å«ç»™å¯Œè£•ç”·äººçš„å¥³æ€§ã€‚å¥¹è¢«æè¿°ä¸ºâ€œç¥ç»è¡°å¼±â€ï¼Œç»å¸¸ç„¦è™‘ã€æˆå‰§åŒ–ä¸”æœ‰äº›æ„šè ¢ã€‚å¥¹ä¸€ç”Ÿä¸­çš„ä¸»è¦ç›®æ ‡æ˜¯çœ‹åˆ°å¥¹çš„å¥³å„¿ä»¬å«å¾—å¥½ï¼Œç‰¹åˆ«æ˜¯å› ä¸ºå¥¹ä»¬å®¶çš„åœ°äº§å·²ç»ä¼ ç»™äº†ç”·æ€§ç»§æ‰¿äººï¼ˆç§‘æ—æ–¯å…ˆç”Ÿï¼‰ï¼Œè¿™æ„å‘³ç€æœ¬å†…ç‰¹å…ˆç”Ÿå»ä¸–åï¼Œå¥¹çš„å¥³å„¿ä»¬å°†å‡ ä¹æ²¡æœ‰ç»æµä¿éšœã€‚å¥¹ç»å¸¸è¢«æè¿°ä¸ºç¼ºä¹æˆç†Ÿå’Œè‰¯å¥½çš„åˆ¤æ–­åŠ›ï¼Œè¿™æœ‰æ—¶ä¼šè®©å¥¹æ›´æ˜æ™ºçš„å¥³å„¿ä»¬ï¼Œç‰¹åˆ«æ˜¯ä¼Šä¸½èç™½æ„Ÿåˆ°å°´å°¬ã€‚

ä»–ä»¬çš„å©šå§»è¢«æç»˜æˆä¸åŒ¹é…çš„å©šå§»ï¼Œæœ¬å†…ç‰¹å…ˆç”Ÿå¹´è½»æ—¶å› ä¸ºå¦»å­çš„ç¾è²Œè€Œå¨¶äº†å¥¹ï¼Œå´å‘ç°ä»–ä»¬åœ¨æ™ºåŠ›å’Œæ€§æ ¼ä¸Šä¸å…¼å®¹ã€‚è¿™æˆä¸ºäº†å…³äºä¸è€ƒè™‘æ€§æ ¼å…¼å®¹æ€§è€Œç»“å©šçš„è­¦ç¤ºæ•…äº‹ã€‚
ç”¨æˆ·è¾“å…¥ tokenï¼š4
è¾“å‡º tokenï¼š297
è¾“å…¥ tokenï¼ˆç¼“å­˜è¯»å–ï¼‰ï¼š187354
è¾“å…¥ tokenï¼ˆç¼“å­˜å†™å…¥ï¼‰ï¼š36
100.0% çš„è¾“å…¥æç¤ºå·²ç¼“å­˜ï¼ˆ187358 ä¸ª tokenï¼‰
è€—æ—¶ï¼š7.53 ç§’

ç¬¬ 3 è½®ï¼š
ç”¨æˆ·ï¼šä»€ä¹ˆæ˜¯å†…ç‘Ÿè²å°”å¾·å…¬å›­ï¼Ÿ
åŠ©æ‰‹ï¼šå†…ç‘Ÿè²å°”å¾·å…¬å›­æ˜¯å°è¯´ä¸­è´å†…ç‰¹å®¶æœ—ä¼¯æ©é™„è¿‘çš„åº„å›­ã€‚å½“å¯Œæœ‰çš„å¹´è½»äººå®¾åˆ©å…ˆç”Ÿæ¬åˆ°é™„è¿‘å¹¶ç§Ÿä¸‹å®ƒæ—¶ï¼Œå®ƒå¯¹æƒ…èŠ‚å˜å¾—å¾ˆé‡è¦ã€‚

å®¾åˆ©å…ˆç”Ÿçš„åˆ°æ¥ä¿ƒä½¿äº†å°è¯´æƒ…èŠ‚çš„å¤§éƒ¨åˆ†å‘å±•ï¼Œå› ä¸ºä»–å¾ˆå¿«å°±å¯¹è´å†…ç‰¹å®¶é•¿å¥³ç®€Â·è´å†…ç‰¹äº§ç”Ÿäº†æµªæ¼«çš„å…´è¶£ã€‚ä¹Ÿæ˜¯é€šè¿‡å†…ç‘Ÿè²å°”å¾·ï¼Œä¼Šä¸½èç™½Â·è´å†…ç‰¹ç¬¬ä¸€æ¬¡é‡åˆ°äº†è¾¾è¥¿å…ˆç”Ÿï¼Œä»–æ˜¯å®¾åˆ©å…ˆç”Ÿçš„æœ‹å‹ï¼Œä¹Ÿä½åœ¨è¿™é‡Œã€‚

å†…ç‘Ÿè²å°”å¾·æ˜¯å°è¯´ä¸­å‡ ä¸ªå…³é”®åœºæ™¯çš„é‡è¦åœ°ç‚¹ï¼ŒåŒ…æ‹¬ï¼š

- è¾¾è¥¿å…ˆç”Ÿç¬¬ä¸€æ¬¡æ€ æ…¢ä¼Šä¸½èç™½çš„èˆä¼š
- ç®€ç”Ÿç—…å¹¶éšåç•™åœ¨å†…ç‘Ÿè²å°”å¾·ï¼ˆä¼Šä¸½èç™½æ¥ç…§é¡¾å¥¹ï¼‰
- è´å†…ç‰¹ä¸€å®¶ä¸å®¾åˆ©-è¾¾è¥¿ä¸€è¡Œäººä¹‹é—´çš„å„ç§ç¤¾äº¤äº’åŠ¨

å†…ç‘Ÿè²å°”å¾·åœ¨å°è¯´ä¸­è±¡å¾ç€è´¢å¯Œå’Œç¤¾ä¼šåœ°ä½ï¼Œå®¾åˆ©å…ˆç”Ÿçš„å…¥ä½ä»£è¡¨ç€è´å†…ç‰¹å®¶æ—é€šè¿‡å©šå§»è·å¾—ç¤¾ä¼šå’Œç»æµåœ°ä½çš„å¯èƒ½æ€§ã€‚å½“å®¾åˆ©å…ˆç”Ÿçªç„¶ç¦»å¼€å†…ç‘Ÿè²å°”å¾·æ—¶ï¼Œè¿™ç»™è´å†…ç‰¹å®¶æ—çš„å¸Œæœ›å¸¦æ¥äº†å·¨å¤§çš„å¤±æœ›å’Œå¹²æ‰°ï¼Œç‰¹åˆ«æ˜¯å¯¹ç®€è€Œè¨€ã€‚
ç”¨æˆ·è¾“å…¥ tokenï¼š4
è¾“å‡º tokenï¼š289
è¾“å…¥ tokenï¼ˆç¼“å­˜è¯»å–ï¼‰ï¼š187390
è¾“å…¥ tokenï¼ˆç¼“å­˜å†™å…¥ï¼‰ï¼š308
100.0% çš„è¾“å…¥æç¤ºå·²ç¼“å­˜ï¼ˆ187394 ä¸ª tokenï¼‰
è€—æ—¶ï¼š6.76 ç§’

ç¬¬ 4 è½®ï¼š
ç”¨æˆ·ï¼šè¿™éƒ¨å°è¯´çš„ä¸»é¢˜æ˜¯ä»€ä¹ˆï¼Ÿ
åŠ©æ‰‹ï¼šå°è¯´ã€Šå‚²æ…¢ä¸åè§ã€‹çš„ä¸»é¢˜æ˜¯å‚²æ…¢ä¸åè§åœ¨äººé™…å…³ç³»ä¸­çš„ç›¸äº’ä½œç”¨ï¼Œç‰¹åˆ«æ˜¯é€šè¿‡ä¼Šä¸½èç™½Â·è´å†…ç‰¹å’Œè¾¾è¥¿å…ˆç”Ÿä¹‹é—´çš„ä¸­å¿ƒæµªæ¼«å…³ç³»æ¥ä½“ç°ã€‚ç„¶è€Œï¼Œè¿˜æœ‰å‡ ä¸ªé‡è¦çš„ç›¸å…³ä¸»é¢˜ï¼š

1. å‚²æ…¢ä¸åè§ï¼š
- è¾¾è¥¿å› å…¶ç¤¾ä¼šåœ°ä½è€Œäº§ç”Ÿçš„å‚²æ…¢æœ€åˆä½¿ä»–æ˜¾å¾—å‚²æ…¢å’Œè½»è”‘
- ä¼Šä¸½èç™½åŸºäºç¬¬ä¸€å°è±¡å’Œå¨å…‹å§†çš„è™šå‡å™è¿°è€Œå¯¹è¾¾è¥¿äº§ç”Ÿçš„åè§
- ä¸¤ä½ä¸»è§’éƒ½å¿…é¡»å…‹æœè¿™äº›ç¼ºç‚¹æ‰èƒ½æ‰¾åˆ°å¹¸ç¦

2. å©šå§»ä¸ç¤¾ä¼šé˜¶å±‚ï¼š
- å¹´è½»å¥³æ€§ä¸ºäº†ç»æµä¿éšœè€Œç»“å©šçš„å‹åŠ›
- ä¸ºçˆ±è€Œç»“å©šä¸ä¸ºç¤¾ä¼šåœ°ä½è€Œç»“å©šä¹‹é—´çš„å†²çª
- å°è¯´æç»˜äº†ä¸åŒç±»å‹çš„å©šå§»ï¼ˆä¼Šä¸½èç™½/è¾¾è¥¿ã€ç®€/å®¾åˆ©ã€è‰è¿ªäºš/å¨å…‹å§†ã€å¤æ´›ç‰¹/ç§‘æ—æ–¯ï¼‰

3. å£°èª‰ä¸ç¤¾ä¼šæœŸæœ›ï¼š
- å£°èª‰åœ¨æ‘„æ”¿ç¤¾ä¼šä¸­çš„é‡è¦æ€§
- è¡Œä¸ºå¦‚ä½•å½±å“å®¶æ—è£èª‰
- è¿™ä¸€æ—¶æœŸå¯¹å¥³æ€§çš„é™åˆ¶

4. ä¸ªäººæˆé•¿ä¸è‡ªæˆ‘è®¤çŸ¥ï¼š
- ä¼Šä¸½èç™½å’Œè¾¾è¥¿éƒ½å­¦ä¼šè®¤è¯†åˆ°è‡ªå·±çš„ç¼ºç‚¹
- å…‹æœç¬¬ä¸€å°è±¡çš„é‡è¦æ€§
- é€šè¿‡ç»éªŒå’Œåæ€å®ç°çš„è§’è‰²å‘å±•

5. å®¶åº­ä¸ç¤¾ä¼šï¼š
- å®¶åº­å…³ç³»åœ¨å†³å®šç¤¾ä¼šåœ°ä½ä¸­çš„ä½œç”¨
- å®¶åº­è¡Œä¸ºå¯¹ä¸ªäººå‰æ™¯çš„å½±å“
- å¹³è¡¡
ç”¨æˆ·è¾“å…¥ tokenï¼š4
è¾“å‡º tokenï¼š300
è¾“å…¥ tokenï¼ˆç¼“å­˜è¯»å–ï¼‰ï¼š187698
è¾“å…¥ tokenï¼ˆç¼“å­˜å†™å…¥ï¼‰ï¼š301
100.0% çš„è¾“å…¥æç¤ºå·²ç¼“å­˜ï¼ˆ187702 ä¸ª tokenï¼‰
è€—æ—¶ï¼š7.13 ç§’
</code></pre>

<p>å¦‚æ‚¨æ‰€è§ï¼Œåœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œåœ¨åˆå§‹ç¼“å­˜è®¾ç½®åï¼Œå“åº”æ—¶é—´ä»è¿‘ 24 ç§’å‡å°‘åˆ°ä»… 7-11 ç§’ï¼ŒåŒæ—¶åœ¨ç­”æ¡ˆä¸­ä¿æŒäº†ç›¸åŒçš„è´¨é‡æ°´å¹³ã€‚å‰©ä½™çš„å¤§éƒ¨åˆ†å»¶è¿Ÿæ˜¯ç”±äºç”Ÿæˆå“åº”æ‰€éœ€çš„æ—¶é—´ï¼Œè¿™ä¸å—æç¤ºç¼“å­˜çš„å½±å“ã€‚</p>
<p>è€Œä¸”ï¼Œç”±äºåœ¨åç»­è½®æ¬¡ä¸­æˆ‘ä»¬å‡ ä¹ç¼“å­˜äº† 100% çš„è¾“å…¥ tokenï¼Œå¹¶ä¸æ–­è°ƒæ•´ç¼“å­˜æ–­ç‚¹ï¼Œå› æ­¤æˆ‘ä»¬å‡ ä¹å¯ä»¥å³æ—¶è¯»å–ä¸‹ä¸€ä¸ªç”¨æˆ·æ¶ˆæ¯ã€‚</p>
            </article>
            
            <nav class="page-nav"><a href="third_party/Deepgram/prerecorded_audio_zh.html" class="nav-link prev">â† è½¬å½•æ·±è“éŸ³é¢‘æ–‡ä»¶å¹¶ä½¿ç”¨ Anthropic å‡†å¤‡é¢è¯•é—®é¢˜ï¼</a><a href="third_party/MongoDB/rag_using_mongodb_zh.html" class="nav-link next">å¦‚ä½•ä½¿ç”¨ Claude 3 å’Œ MongoDB æ„å»º RAG ç³»ç»Ÿ â†’</a></nav>
        </main>
    </div>
</body>
</html>
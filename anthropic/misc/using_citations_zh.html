<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="../">
    <title>引言</title>
    <link rel="stylesheet" href="assets/style.css">
    <link rel="stylesheet" href="assets/highlight.css">
    <script src="assets/script.js" defer></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$']],
                displayMath: [['$$', '$$']],
                processEscapes: false,
                packages: {'[+]': ['noerrors', 'ams']}
            },
            options: {
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
            },
            loader: {
                load: ['[tex]/noerrors', '[tex]/ams']
            }
        };
    </script>
</head>
<body>
    <div class="container">
        <nav id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <h3>目录</h3>
                <button id="sidebar-toggle" class="sidebar-toggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
            <div class="sidebar-search">
                <input type="text" id="sidebar-search-input" placeholder="搜索..." autocomplete="off">
            </div>
            <div id="tree-container">
                <nav class="tree-nav" role="tree">
                    <div class="tree-folder " data-level="0" >
                        <div class="tree-folder-header">
                            <span class="tree-arrow">▶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">extended_thinking</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="extended_thinking/extended_thinking_with_tool_use_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">扩展思考与工具使用</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="extended_thinking/extended_thinking_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">扩展思考</span>
                        </a>
                    </div>
                </div></div>
                    <div class="tree-folder " data-level="0" >
                        <div class="tree-folder-header">
                            <span class="tree-arrow">▶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">finetuning</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="finetuning/finetuning_on_bedrock_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">在 Bedrock 上微调 Claude 3 Haiku</span>
                        </a>
                    </div>
                </div></div>
                    <div class="tree-folder expanded" data-level="0" >
                        <div class="tree-folder-header">
                            <span class="tree-arrow">▶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">misc</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/batch_processing_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">批量处理消息批次API</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/building_evals_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">建立评估</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/building_moderation_filter_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">建立一个带有 Claude 的审核过滤器</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/generate_test_cases_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">首先，我们有 `extract_variables` 函数，</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/how_to_enable_json_mode_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">提示 Claude 获取“JSON 模式”</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/how_to_make_sql_queries_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">如何使用 Claude 进行 SQL 查询</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/illustrated_responses_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">Claude 的图示化响应</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/mc_qa_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">实验性测试 Claude 的长上下文问答能力</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/metaprompt_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">Metaprompt</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/pdf_upload_summarization_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">“上传”PDF 到 Claude API</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/prompt_caching_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">缓存提示（Prompt caching）通过 Anthropic API</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/read_web_pages_with_haiku_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">使用 Claude 3 Haiku 总结网页内容</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/sampling_past_max_tokens_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">Claude 从 Claude 之外的采样响应，超出最大令牌限制</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/speculative_prompt_caching_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">投机性提示缓存</span>
                        </a>
                    </div>
                
                    <div class="tree-item active" style="padding-left: 20px;">
                        <a href="misc/using_citations_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">引言</span>
                        </a>
                    </div>
                </div></div>
                    <div class="tree-folder " data-level="0" >
                        <div class="tree-folder-header">
                            <span class="tree-arrow">▶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">multimodal</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="multimodal/best_practices_for_vision_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">Untitled</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="multimodal/getting_started_with_vision_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">开始上手 - 如何将图像传递给 Claude</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="multimodal/how_to_transcribe_text_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">如何使用 Claude 转录文档</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="multimodal/reading_charts_graphs_powerpoints_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">使用图表和幻灯片放映</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="multimodal/using_sub_agents_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">使用 Haiku 作为子代理</span>
                        </a>
                    </div>
                </div></div>
                    <div class="tree-folder " data-level="0" >
                        <div class="tree-folder-header">
                            <span class="tree-arrow">▶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">patterns</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-folder " data-level="1" style="padding-left: 20px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">▶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">agents</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="patterns/agents/basic_workflows_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">首先使用具有思维链的LLM确定适当的路由</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="patterns/agents/evaluator_optimizer_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">Untitled</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="patterns/agents/orchestrator_workers_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">步骤1：获取协调器响应</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="patterns/agents/README_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">构建高效代理的食谱</span>
                        </a>
                    </div>
                
                    <div class="tree-folder " data-level="2" style="padding-left: 40px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">▶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">prompts</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 60px;">
                        <a href="patterns/agents/prompts/citations_agent_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">Untitled</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 60px;">
                        <a href="patterns/agents/prompts/research_lead_agent_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">Untitled</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 60px;">
                        <a href="patterns/agents/prompts/research_subagent_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">Untitled</span>
                        </a>
                    </div>
                </div></div></div></div></div></div>
                    <div class="tree-folder " data-level="0" >
                        <div class="tree-folder-header">
                            <span class="tree-arrow">▶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">skills</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="skills/README_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">Claude 技能</span>
                        </a>
                    </div>
                
                    <div class="tree-folder " data-level="1" style="padding-left: 20px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">▶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">classification</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="skills/classification/guide_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">设置我们的环境</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="skills/classification/README_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">Claude 分类指南</span>
                        </a>
                    </div>
                
                    <div class="tree-folder " data-level="2" style="padding-left: 40px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">▶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">evaluation</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 60px;">
                        <a href="skills/classification/evaluation/README_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">使用 Promptfoo 进行评估</span>
                        </a>
                    </div>
                </div></div></div></div>
                    <div class="tree-folder " data-level="1" style="padding-left: 20px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">▶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">contextual-embeddings</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="skills/contextual-embeddings/guide_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">增强检索的RAG与上下文检索</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="skills/contextual-embeddings/README_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">结合上下文嵌入的检索增强生成</span>
                        </a>
                    </div>
                </div></div>
                    <div class="tree-folder " data-level="1" style="padding-left: 20px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">▶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">retrieval_augmented_generation</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="skills/retrieval_augmented_generation/guide_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">Retrieval Augmented Generation (RAG)</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="skills/retrieval_augmented_generation/README_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">Untitled</span>
                        </a>
                    </div>
                
                    <div class="tree-folder " data-level="2" style="padding-left: 40px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">▶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">evaluation</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 60px;">
                        <a href="skills/retrieval_augmented_generation/evaluation/README_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">使用 Promptfoo 进行评估</span>
                        </a>
                    </div>
                </div></div></div></div>
                    <div class="tree-folder " data-level="1" style="padding-left: 20px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">▶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">summarization</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="skills/summarization/guide_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">摘要与 Claude</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="skills/summarization/README_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">Claude 摘要</span>
                        </a>
                    </div>
                
                    <div class="tree-folder " data-level="2" style="padding-left: 40px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">▶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">evaluation</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 60px;">
                        <a href="skills/summarization/evaluation/README_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">Promptfoo 评估</span>
                        </a>
                    </div>
                </div></div></div></div>
                    <div class="tree-folder " data-level="1" style="padding-left: 20px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">▶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">text_to_sql</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="skills/text_to_sql/guide_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">Set your Anthropic API key</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="skills/text_to_sql/README_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">Claude 的文本到 SQL</span>
                        </a>
                    </div>
                
                    <div class="tree-folder " data-level="2" style="padding-left: 40px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">▶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">evaluation</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 60px;">
                        <a href="skills/text_to_sql/evaluation/README_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">Promptfoo 评估</span>
                        </a>
                    </div>
                </div></div></div></div></div></div>
                    <div class="tree-folder " data-level="0" >
                        <div class="tree-folder-header">
                            <span class="tree-arrow">▶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">third_party</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-folder " data-level="1" style="padding-left: 20px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">▶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">Deepgram</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/Deepgram/prerecorded_audio_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">转录深蓝音频文件并使用 Anthropic 准备面试问题！</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/Deepgram/README_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">Deepgram <> Anthropic Cookbooks</span>
                        </a>
                    </div>
                </div></div>
                    <div class="tree-folder " data-level="1" style="padding-left: 20px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">▶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">LlamaIndex</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/LlamaIndex/Basic_RAG_With_LlamaIndex_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">RAG 管道与 LlamaIndex</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/LlamaIndex/Multi_Document_Agents_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">多文档代理</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/LlamaIndex/Multi_Modal_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">多模态</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/LlamaIndex/ReAct_Agent_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">ReAct Agent</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/LlamaIndex/README_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">LlamaIndex <> Anthropic Cookbooks</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/LlamaIndex/Router_Query_Engine_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">注意：这仅在 jupyter notebook 中是必需的。</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/LlamaIndex/SubQuestion_Query_Engine_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">SubQuestionQueryEngine</span>
                        </a>
                    </div>
                </div></div>
                    <div class="tree-folder " data-level="1" style="padding-left: 20px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">▶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">MongoDB</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/MongoDB/rag_using_mongodb_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">如何使用 Claude 3 和 MongoDB 构建 RAG 系统</span>
                        </a>
                    </div>
                </div></div>
                    <div class="tree-folder " data-level="1" style="padding-left: 20px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">▶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">Pinecone</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/Pinecone/claude_3_rag_agent_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">检查 Python 版本</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/Pinecone/rag_using_pinecone_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">使用 Pinecone 进行检索增强生成</span>
                        </a>
                    </div>
                </div></div>
                    <div class="tree-folder " data-level="1" style="padding-left: 20px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">▶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">VoyageAI</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/VoyageAI/how_to_create_embeddings_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">这将自动使用环境变量VOYAGE_API_KEY。</span>
                        </a>
                    </div>
                </div></div>
                    <div class="tree-folder " data-level="1" style="padding-left: 20px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">▶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">Wikipedia</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/Wikipedia/wikipedia-search-cookbook_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">迭代搜索维基百科与 Claude</span>
                        </a>
                    </div>
                </div></div>
                    <div class="tree-folder " data-level="1" style="padding-left: 20px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">▶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">WolframAlpha</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/WolframAlpha/using_llm_api_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">使用 Wolfram Alpha LLM API 作为 Claude 的工具</span>
                        </a>
                    </div>
                </div></div></div></div>
                    <div class="tree-folder " data-level="0" >
                        <div class="tree-folder-header">
                            <span class="tree-arrow">▶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">tool_use</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="tool_use/calculator_tool_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">使用计算器工具与 Claude</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="tool_use/customer_service_agent_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">使用客户端工具创建客服代理</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="tool_use/extracting_structured_json_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">使用 Claude 和工具使用功能提取结构化 JSON</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="tool_use/memory_cookbook_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">安装依赖</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="tool_use/parallel_tools_claude_3_7_sonnet_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">在 Claude 3.7 Sonnet 上并行调用工具</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="tool_use/tool_choice_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">选择工具</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="tool_use/tool_use_with_pydantic_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">记事工具，支持 Pydantic 和 Anthropic 工具使用</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="tool_use/vision_with_tools_zh.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">使用 Vision 与工具</span>
                        </a>
                    </div>
                </div></div></nav>
            </div>
        </nav>
        
        <main class="content">
            <article>
                <h1 id="_1">引言</h1>
<p>Anthropic API 支持引文功能，该功能使 Claude 在回答有关文档的问题时能够提供详细的引文。引文是许多由 LLM 驱动的应用程序中的宝贵功能，可帮助用户跟踪和验证响应中信息的来源。</p>
<p>引文支持以下模型：</p>
<ul>
<li><code>claude-3-5-sonnet-20241022</code></li>
<li><code>claude-3-5-haiku-20241022</code></li>
</ul>
<p>引文功能是基于提示的引文技术的替代方案。使用此功能具有以下优点：</p>
<ul>
<li>基于提示的技术通常要求 Claude 输出其打算引用的源文档的完整引用。这会增加输出令牌，从而增加成本。</li>
<li>引文功能不会返回指向未提供为有效来源的文档或位置的引文。</li>
<li>在测试期间，我们发现引文功能生成的引文比基于提示的技术具有更高的召回率和精确度。</li>
</ul>
<p>引文的文档可以在<a href="https://docs.anthropic.com/en/docs/build-with-claude/citations">此处</a>找到。</p>
<h2 id="_2">设置</h2>
<p>首先，让我们安装所需的库并初始化我们的 Anthropic 客户端。</p>
<pre class="codehilite"><code class="language-python">!pip install anthropic  --quiet
</code></pre>

<pre class="codehilite"><code class="language-python">import anthropic
import os
import json

ANTHROPIC_API_KEY = os.environ.get(&quot;ANTHROPIC_API_KEY&quot;)
# ANTHROPIC_API_KEY = &quot;&quot; # 在此处放置您的 API 密钥！

client = anthropic.Anthropic(api_key=ANTHROPIC_API_KEY)
</code></pre>

<h2 id="_3">文档类型</h2>
<p>引文支持三种不同的文档类型。输出的引文类型取决于所引用的文档类型：</p>
<ul>
<li>纯文本文档引文 → 字符位置格式</li>
<li>PDF 文档引文 → 页面位置格式</li>
<li>自定义内容文档引文 → 内容块位置格式</li>
</ul>
<p>我们将在下面的示例中探讨如何处理这三种文档类型。</p>
<h3 id="_4">纯文本文档</h3>
<p>使用纯文本文档引文时，您将原始文本作为文档提供给模型。您可以提供一个或多个文档。这些文本将被自动分块成句子。模型将根据需要引用这些句子。模型可以一次性引用多个句子，但不会引用小于句子的文本。</p>
<p>除了输出的文本外，API 响应还将包含所有引文的结构化数据。</p>
<p>让我们通过一个虚构公司 PetWorld 的帮助中心客户聊天机器人来了解一个完整的示例。</p>
<pre class="codehilite"><code class="language-python"># 读取所有帮助中心文章并创建一个文档列表
articles_dir = './data/help_center_articles'
documents = []

for filename in sorted(os.listdir(articles_dir)):
    if filename.endswith('.txt'):
        with open(os.path.join(articles_dir, filename), 'r') as f:
            content = f.read()
            # 分割标题和正文
            title_line, body = content.split('\n', 1)
            title = title_line.replace('title: ', '')
            documents.append({
                &quot;type&quot;: &quot;document&quot;,
                &quot;source&quot;: {
                    &quot;type&quot;: &quot;text&quot;,
                    &quot;media_type&quot;: &quot;text/plain&quot;,
                    &quot;data&quot;: body
                },
                &quot;title&quot;: title,
                &quot;citations&quot;: {&quot;enabled&quot;: True}
            })

QUESTION = &quot;我刚完成结账，我的订单追踪号在哪里？追踪包裹在网站上还不可用。&quot;

# 将问题添加到内容中
content = documents

response = client.messages.create(
    model=&quot;claude-3-5-sonnet-latest&quot;,
    temperature=0.0,
    max_tokens=1024,
    system='您是 PetWorld 的客服机器人。您的任务是简短、有帮助地回答用户的问题。由于您处于聊天界面，请避免提供额外的细节。您将可以访问 PetWorld 的帮助中心文章来帮助您回答问题。',
    messages=[
        {
            &quot;role&quot;: &quot;user&quot;,
            &quot;content&quot;: documents
        },
        {
            &quot;role&quot;: &quot;user&quot;,
            &quot;content&quot;: [{&quot;type&quot;: &quot;text&quot;, &quot;text&quot;: f'这是用户的问题：{QUESTION}'}]
        },

    ]
)

def visualize_raw_response(response):
    raw_response = {&quot;content&quot;: []}

    print(&quot;\n&quot; + &quot;=&quot;*80 + &quot;\n原始响应：\n&quot; + &quot;=&quot;*80)

    for content in response.content:
        if content.type == &quot;text&quot;:
            block = {
                &quot;type&quot;: &quot;text&quot;,
                &quot;text&quot;: content.text
            }
            if hasattr(content, 'citations') and content.citations:
                block[&quot;citations&quot;] = []
                for citation in content.citations:
                    citation_dict = {
                        &quot;type&quot;: citation.type,
                        &quot;cited_text&quot;: citation.cited_text,
                        &quot;document_title&quot;: citation.document_title,
                    }
                    if citation.type == &quot;page_location&quot;:
                        citation_dict.update({
                            &quot;start_page_number&quot;: citation.start_page_number,
                            &quot;end_page_number&quot;: citation.end_page_number
                        })
                    block[&quot;citations&quot;].append(citation_dict)
            raw_response[&quot;content&quot;].append(block)

    return json.dumps(raw_response, indent=2)

print(visualize_raw_response(response))
</code></pre>

<pre class="codehilite"><code>================================================================================
原始响应：
================================================================================
{
  &quot;content&quot;: [
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;根据文档，我可以解释为什么您还看不到追踪信息：&quot;
    },
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;一旦您的订单发货，您将收到一封包含追踪号码的电子邮件。如果您在订单确认后 48 小时内未收到追踪号码，请联系我们的客户支持团队寻求帮助。&quot;,
      &quot;citations&quot;: [
        {
          &quot;type&quot;: &quot;char_location&quot;,
          &quot;cited_text&quot;: &quot;一旦您的订单发货，您将收到一封包含追踪号码的电子邮件。 &quot;,
          &quot;document_title&quot;: &quot;订单追踪信息&quot;
        },
        {
          &quot;type&quot;: &quot;char_location&quot;,
          &quot;cited_text&quot;: &quot;如果您在订单确认后 48 小时内未收到追踪号码，请联系我们的客户支持团队。&quot;,
          &quot;document_title&quot;: &quot;订单追踪信息&quot;
        }
      ]
    },
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;\n\n由于您刚刚完成结账，您的订单可能还没有发货。一旦发货，您将通过电子邮件收到追踪信息。&quot;
    }
  ]
}
</code></pre>

<h4 id="_5">可视化引文</h4>
<p>通过利用引文数据，我们可以创建以下 UI：</p>
<ol>
<li>精确显示信息来源</li>
<li>直接链接到源文档</li>
<li>在上下文中突出显示引用的文本</li>
<li>通过透明的来源建立信任</li>
</ol>
<p>下面是一个简单的可视化函数，它将 Claude 的结构化引文转换为带有编号引用的可读格式，类似于学术论文。</p>
<p>该函数接受 Claude 的响应对象并输出：</p>
<ul>
<li>带有编号引文标记的文本（例如，“答案 [1] 包含此事实 [2]”）</li>
<li>一个编号的参考列表，显示每个引用的文本及其源文档</li>
</ul>
<pre class="codehilite"><code class="language-python">def visualize_citations(response):
    &quot;&quot;&quot;
    接受响应对象并返回带有编号引文的字符串。
    示例输出：“这是纯文本答案 [1][2] 这是更多文本 [3]”
    并在下方附带引文列表。
    &quot;&quot;&quot;
    # 用于存储唯一引文的字典
    citations_dict = {}
    citation_counter = 1

    # 最终格式化的文本
    formatted_text = &quot;&quot;
    citations_list = []

    print(&quot;\n&quot; + &quot;=&quot;*80 + &quot;\n格式化响应：\n&quot; + &quot;=&quot;*80)

    for content in response.content:
        if content.type == &quot;text&quot;:
            text = content.text
            if hasattr(content, 'citations') and content.citations:
                # 按引文在文本中出现的顺序排序
                def get_sort_key(citation):
                    if hasattr(citation, 'start_char_index'):
                        return citation.start_char_index
                    elif hasattr(citation, 'start_page_number'):
                        return citation.start_page_number
                    elif hasattr(citation, 'start_block_index'):
                        return citation.start_block_index
                    return 0  # 回退

                sorted_citations = sorted(content.citations, key=get_sort_key)

                # 处理每个引文
                for citation in sorted_citations:
                    doc_title = citation.document_title
                    cited_text = citation.cited_text.replace('\n', ' ').replace('\r', ' ')
                    # 删除可能创建的任何多个空格
                    cited_text = ' '.join(cited_text.split())

                    # 为此引文创建唯一键
                    citation_key = f&quot;{doc_title}:{cited_text}&quot;

                    # 如果这是新引文，请将其添加到我们的字典中
                    if citation_key not in citations_dict:
                        citations_dict[citation_key] = citation_counter
                        citations_list.append(f&quot;[{citation_counter}] \&quot;{cited_text}\&quot; 找到于 \&quot;{doc_title}\&quot;&quot;)
                        citation_counter += 1

                    # 将引文编号添加到文本中
                    citation_num = citations_dict[citation_key]
                    text += f&quot; [{citation_num}]&quot;

            formatted_text += text

    # 将格式化文本与引文列表合并
    final_output = formatted_text + &quot;\n\n&quot; + &quot;\n&quot;.join(citations_list)
    return final_output

formatted_response = visualize_citations(response)
print(formatted_response)
</code></pre>

<pre class="codehilite"><code>================================================================================
格式化响应：
================================================================================
根据文档，我可以解释为什么您还看不到追踪信息：您将收到一封包含追踪号码的电子邮件，一旦您的订单发货。如果您在订单确认后 48 小时内未收到追踪号码，请联系我们的客户支持团队寻求帮助。[1][2]

由于您刚刚完成结账，您的订单可能还没有发货。一旦发货，您将通过电子邮件收到追踪信息。

[1] &quot;一旦您的订单发货，您将收到一封包含追踪号码的电子邮件。&quot; 找到于 &quot;订单追踪信息&quot;
[2] &quot;如果您在订单确认后 48 小时内未收到追踪号码，请联系我们的客户支持团队。&quot; 找到于 &quot;订单追踪信息&quot;
</code></pre>

<h3 id="pdf">PDF 文档</h3>
<p>处理 PDF 时，Claude 可以提供引用特定页码的引文，从而轻松跟踪信息来源。以下是 PDF 引文的工作方式：</p>
<ul>
<li>PDF 文档内容以 base64 编码的数据形式提供</li>
<li>文本会自动分块成句子</li>
<li>引文包含信息所在的页码（从 1 开始计数）</li>
<li>模型可以一次性引用多个句子，但不会引用小于句子的文本</li>
<li>虽然图像会被处理，但目前只有文本内容可以被引用</li>
</ul>
<p>以下是一个使用 Constitutional AI 论文的示例，以演示 PDF 引文：</p>
<pre class="codehilite"><code class="language-python">import base64
import json

# 读取并编码 PDF
pdf_path = 'data/Constitutional AI.pdf'
with open(pdf_path, &quot;rb&quot;) as f:
    pdf_data = base64.b64encode(f.read()).decode()

pdf_response = client.messages.create(
    model=&quot;claude-3-5-sonnet-latest&quot;,
    temperature=0.0,
    max_tokens=1024,
    messages=[
        {
            &quot;role&quot;: &quot;user&quot;,
            &quot;content&quot;: [
                {
                    &quot;type&quot;: &quot;document&quot;,
                    &quot;source&quot;: {
                        &quot;type&quot;: &quot;base64&quot;,
                        &quot;media_type&quot;: &quot;application/pdf&quot;,
                        &quot;data&quot;: pdf_data
                    },
                    &quot;title&quot;: &quot;Constitutional AI Paper&quot;,
                    &quot;citations&quot;: {&quot;enabled&quot;: True}
                },
                {
                    &quot;type&quot;: &quot;text&quot;,
                    &quot;text&quot;: &quot;Constitutional AI 的主要思想是什么？&quot;
                }
            ]
        }
    ]
)

print(visualize_raw_response(pdf_response))
print(visualize_citations(pdf_response))
</code></pre>

<pre class="codehilite"><code>================================================================================
原始响应：
================================================================================
{
  &quot;content&quot;: [
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;根据论文，以下是 Constitutional AI 的关键方面：\n\n&quot;
    },
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;Constitutional AI 是一种通过自我改进来训练无害 AI 助手的无害方法，无需任何人类标签来识别有害输出。唯一的人类监督是通过一组规则或原则提供的，因此得名“Constitutional AI”。&quot;,
      &quot;citations&quot;: [
        {
          &quot;type&quot;: &quot;page_location&quot;,
          &quot;cited_text&quot;: &quot;我们通过自我改进来训练无害 AI 助手的无害方法，无需任何人类标签来识别有害输出。唯一的人类监督是通过一组规则或原则提供的，因此我们称该方法为“Constitutional AI”。 &quot;,
          &quot;document_title&quot;: &quot;Constitutional AI Paper&quot;,
          &quot;start_page_number&quot;: 1,
          &quot;end_page_number&quot;: 2
        }
      ]
    },
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;\n\n该过程包括两个主要阶段：\n\n1. 监督学习阶段：\n&quot;
    },
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;在此阶段，他们从初始模型中采样，生成自我批评和修订，然后使用修订后的响应对原始模型进行微调。&quot;,
      &quot;citations&quot;: [
        {
          &quot;type&quot;: &quot;page_location&quot;,
          &quot;cited_text&quot;: &quot;在监督阶段，我们从初始模型中采样，然后生成自我批评和修订，然后使用修订后的响应对原始模型进行微调。 &quot;,
          &quot;document_title&quot;: &quot;Constitutional AI Paper&quot;,
          &quot;start_page_number&quot;: 1,
          &quot;end_page_number&quot;: 2
        }
      ]
    },
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;\n\n2. 强化学习阶段：\n&quot;
    },
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;在此阶段，他们：\n- 从微调模型中采样\n- 使用模型评估两个样本中的哪个更好\n- 从这个 AI 偏好数据集中训练一个偏好模型\n- 使用“RL 来自 AI 反馈”（RLAIF）&quot;,
      &quot;citations&quot;: [
        {
          &quot;type&quot;: &quot;page_location&quot;,
          &quot;cited_text&quot;: &quot;在 RL 阶段，我们从微调模型中采样，使用模型评估两个样本中的哪个更好，然后从这个 AI 偏好数据集中训练一个偏好模型。然后我们使用偏好模型作为奖励信号进行 RL 训练，即我们使用“RL 来自 AI 反馈”（RLAIF）。 &quot;,
          &quot;document_title&quot;: &quot;Constitutional AI Paper&quot;,
          &quot;start_page_number&quot;: 1,
          &quot;end_page_number&quot;: 2
        }
      ]
    },
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;\n\n主要成果是：\n\n&quot;
    },
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;- 他们能够训练一个无害但不过于回避的 AI 助手，该助手通过解释其反对意见来处理有害查询\n- SL 和 RL 方法都可以利用思维链式推理来提高人类判断的性能和 AI 决策的透明度\n- 这些方法使得能够更精确地控制 AI 行为，并且所需的人类标签更少&quot;,
      &quot;citations&quot;: [
        {
          &quot;type&quot;: &quot;page_location&quot;,
          &quot;cited_text&quot;: &quot;结果，我们能够训练一个无害但不过于回避的 AI 助手，该助手通过解释其反对意见来处理有害查询。SL 和 RL 方法都可以利用思维链式推理来提高人类判断的性能和 AI 决策的透明度。这些方法使得能够更精确地控制 AI 行为，并且所需的人类标签更少。&quot;,
          &quot;document_title&quot;: &quot;Constitutional AI Paper&quot;,
          &quot;start_page_number&quot;: 1,
          &quot;end_page_number&quot;: 2
        }
      ]
    },
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;\n\n&quot;
    },
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;最终目标不是完全消除人类监督，而是使其更有效、更透明和更有针对性。虽然这项工作减少了对人类监督以确保无害性的依赖，但他们仍然依赖于有帮助性标签形式的人类监督。研究人员预计，从预训练的 LM 和广泛的提示开始，有可能在没有人为反馈的情况下实现有帮助性和指令遵循性，但这留给未来的工作。&quot;,
      &quot;citations&quot;: [
        {
          &quot;type&quot;: &quot;page_location&quot;,
          &quot;cited_text&quot;: &quot;通过删除无害性的人类反馈标签，我们已经远离了对人类监督的依赖，并更接近于实现对齐的自我监督方法。然而，在这项工作中，我们仍然依赖于有帮助性标签形式的人类监督。我们预计，从预训练的 LM 和广泛的提示开始，有可能在没有人为反馈的情况下实现有帮助性和指令遵循性，但这留给未来的工作。我们的最终目标不是完全消除人类监督，而是使其更有效、更透明和更有针对性。&quot;,
          &quot;document_title&quot;: &quot;Constitutional AI Paper&quot;,
          &quot;start_page_number&quot;: 15,
          &quot;end_page_number&quot;: 16
        }
      ]
    }
  ]
}

================================================================================
格式化响应：
================================================================================
根据论文，以下是 Constitutional AI 的关键方面：

Constitutional AI 是一种通过自我改进来训练无害 AI 助手的无害方法，无需任何人类标签来识别有害输出。唯一的人类监督是通过一组规则或原则提供的，因此得名“Constitutional AI”。[1]

该过程包括两个主要阶段：

1. 监督学习阶段：
在此阶段，他们从初始模型中采样，生成自我批评和修订，然后使用修订后的响应对原始模型进行微调。[2]

2. 强化学习阶段：
在此阶段，他们：

- 从微调模型中采样
- 使用模型评估两个样本中的哪个更好
- 从这个 AI 偏好数据集中训练一个偏好模型
- 使用“RL 来自 AI 反馈”（RLAIF）[3]

主要成果是：

- 他们能够训练一个无害但不过于回避的 AI 助手，该助手通过解释其反对意见来处理有害查询
- SL 和 RL 方法都可以利用思维链式推理来提高人类判断的性能和 AI 决策的透明度
- 这些方法使得能够更精确地控制 AI 行为，并且所需的人类标签更少[4]

最终目标不是完全消除人类监督，而是使其更有效、更透明和更有针对性。虽然这项工作减少了对人类监督以确保无害性的依赖，但他们仍然依赖于有帮助性标签形式的人类监督。研究人员预计，从预训练的 LM 和广泛的提示开始，有可能在没有人为反馈的情况下实现有帮助性和指令遵循性，但这留给未来的工作。[5]

[1] &quot;我们通过自我改进来训练无害 AI 助手的无害方法，无需任何人类标签来识别有害输出。唯一的人类监督是通过一组规则或原则提供的，因此我们称该方法为“Constitutional AI”。&quot; 找到于 &quot;Constitutional AI Paper&quot;
[2] &quot;在监督阶段，我们从初始模型中采样，然后生成自我批评和修订，然后使用修订后的响应对原始模型进行微调。&quot; 找到于 &quot;Constitutional AI Paper&quot;
[3] &quot;在 RL 阶段，我们从微调模型中采样，使用模型评估两个样本中的哪个更好，然后从这个 AI 偏好数据集中训练一个偏好模型。然后我们使用偏好模型作为奖励信号进行 RL 训练，即我们使用“RL 来自 AI 反馈”（RLAIF）。&quot; 找到于 &quot;Constitutional AI Paper&quot;
[4] &quot;结果，我们能够训练一个无害但不过于回避的 AI 助手，该助手通过解释其反对意见来处理有害查询。SL 和 RL 方法都可以利用思维链式推理来提高人类判断的性能和 AI 决策的透明度。这些方法使得能够更精确地控制 AI 行为，并且所需的人类标签更少。&quot; 找到于 &quot;Constitutional AI Paper&quot;
[5] &quot;通过删除无害性的人类反馈标签，我们已经远离了对人类监督的依赖，并更接近于实现对齐的自我监督方法。然而，在这项工作中，我们仍然依赖于有帮助性标签形式的人类监督。我们预计，从预训练的 LM 和广泛的提示开始，有可能在没有人为反馈的情况下实现有帮助性和指令遵循性，但这留给未来的工作。我们的最终目标不是完全消除人类监督，而是使其更有效、更透明和更有针对性。&quot; 找到于 &quot;Constitutional AI Paper&quot;
</code></pre>

<h3 id="_6">自定义内容文档</h3>
<p>虽然纯文本文档会自动分块成句子，但自定义内容文档可让您完全控制引文的粒度。此 API 形状允许您：</p>
<ul>
<li>定义自己的任意大小的块</li>
<li>控制最小引文单元</li>
<li>优化不适合句子分块的文档</li>
</ul>
<p>在下面的示例中，我们使用与纯文本示例相同的帮助中心文章，但我们不使用句子级引文，而是将每篇文章视为一个单独的块。这演示了文档类型选择如何影响引文行为和粒度。您会注意到 <code>cited_text</code> 是整篇文章，而不是源文章中的一个句子。</p>
<pre class="codehilite"><code class="language-python"># 读取所有帮助中心文章并创建一个自定义内容文档列表
articles_dir = './data/help_center_articles'
documents = []

for filename in sorted(os.listdir(articles_dir)):
    if filename.endswith('.txt'):
        with open(os.path.join(articles_dir, filename), 'r') as f:
            content = f.read()
            # 分割标题和正文
            title_line, body = content.split('\n', 1)
            title = title_line.replace('title: ', '')

            documents.append({
                &quot;type&quot;: &quot;document&quot;,
                &quot;source&quot;: {
                    &quot;type&quot;: &quot;content&quot;,
                    &quot;content&quot;: [
                        {&quot;type&quot;: &quot;text&quot;, &quot;text&quot;: body}
                    ]
                },
                &quot;title&quot;: title,
                &quot;citations&quot;: {&quot;enabled&quot;: True}
            })

QUESTION = &quot;我刚完成结账，我的订单追踪号在哪里？追踪包裹在网站上还不可用。&quot;

custom_content_response = client.messages.create(
    model=&quot;claude-3-5-sonnet-latest&quot;,
    temperature=0.0,
    max_tokens=1024,
    system='您是 PetWorld 的客服机器人。您的任务是简短、有帮助地回答用户的问题。由于您处于聊天界面，请避免提供额外的细节。您将可以访问 PetWorld 的帮助中心文章来帮助您回答问题。',
    messages=[
        {
            &quot;role&quot;: &quot;user&quot;,
            &quot;content&quot;: documents
        },
        {
            &quot;role&quot;: &quot;user&quot;,
            &quot;content&quot;: [{&quot;type&quot;: &quot;text&quot;, &quot;text&quot;: f'这是用户的问题：{QUESTION}'}]
        }
    ]
)

print(visualize_raw_response(custom_content_response))
print(visualize_citations(custom_content_response))
</code></pre>

<pre class="codehilite"><code>================================================================================
原始响应：
================================================================================
{
  &quot;content&quot;: [
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;一旦您的订单发货，您将收到一封包含追踪号码的电子邮件。如果您在订单确认后 48 小时内未收到追踪号码，请联系我们的客户支持团队寻求帮助。&quot;,
      &quot;citations&quot;: [
        {
          &quot;type&quot;: &quot;content_block_location&quot;,
          &quot;cited_text&quot;: &quot;一旦您的订单发货，您将收到一封包含追踪号码的电子邮件。要追踪您的包裹，请登录您的 PetWorld 帐户并转到“订单历史记录”。点击您要追踪的订单，然后选择“追踪包裹”。这将显示您当前的订单状态和预计送达日期。您也可以在我们的运输合作伙伴的网站上直接输入追踪号码以获取更详细的信息。如果您在订单确认后 48 小时内未收到追踪号码，请联系我们的客户支持团队。&quot;,
          &quot;document_title&quot;: &quot;订单追踪信息&quot;
        }
      ]
    }
  ]
}

================================================================================
格式化响应：
================================================================================
一旦您的订单发货，您将收到一封包含追踪号码的电子邮件。如果您在订单确认后 48 小时内未收到追踪号码，请联系我们的客户支持团队寻求帮助。[1]

[1] &quot;一旦您的订单发货，您将收到一封包含追踪号码的电子邮件。要追踪您的包裹，请登录您的 PetWorld 帐户并转到“订单历史记录”。点击您要追踪的订单，然后选择“追踪包裹”。这将显示您当前的订单状态和预计送达日期。您也可以在我们的运输合作伙伴的网站上直接输入追踪号码以获取更详细的信息。如果您在订单确认后 48 小时内未收到追踪号码，请联系我们的客户支持团队。&quot; 找到于 &quot;订单追踪信息&quot;
</code></pre>

<h3 id="context">使用 Context 字段</h3>
<p><code>context</code> 字段允许您提供有关 Claude 可以使用的文档的附加信息，但这些信息不会被引用。这对于以下方面很有用：</p>
<ul>
<li>提供文档元数据（例如，发布日期、作者）</li>
<li><a href="https://www.anthropic.com/news/contextual-retrieval">上下文检索</a></li>
<li>包含不应直接引用的使用说明或上下文</li>
</ul>
<p>在下面的示例中，我们提供了一篇带有上下文字段的忠诚度计划文章。请注意 Claude 如何使用上下文中的信息来指导其响应，但上下文字段的内容不能用于引用。</p>
<pre class="codehilite"><code class="language-python">import json

# 创建一个带有上下文字段的文档
document = {
    &quot;type&quot;: &quot;document&quot;,
    &quot;source&quot;: {
        &quot;type&quot;: &quot;text&quot;,
        &quot;media_type&quot;: &quot;text/plain&quot;,
        &quot;data&quot;: &quot;PetWorld 提供忠诚度计划，客户每花费一美元可赚取 1 个积分。累积 100 个积分后，您将获得 5 美元的奖励，可用于下次购买。积分在赚取后 12 个月内到期。您可以在您的帐户仪表板中或通过咨询客服来查看您的积分余额。&quot;
    },
    &quot;title&quot;: &quot;忠诚度计划详情&quot;,
    &quot;context&quot;: &quot;警告：本文档已 12 个月未更新。内容可能已过时。在提供指导后，请务必告知用户此内容可能不正确。&quot;,
    &quot;citations&quot;: {&quot;enabled&quot;: True}
}

QUESTION = &quot;PetWorld 的忠诚度计划是如何运作的？积分何时到期？&quot;

context_response = client.messages.create(
    model=&quot;claude-3-5-sonnet-latest&quot;,
    temperature=0.0,
    max_tokens=1024,
    messages=[
        {
            &quot;role&quot;: &quot;user&quot;,
            &quot;content&quot;: [
                document,
                {
                    &quot;type&quot;: &quot;text&quot;,
                    &quot;text&quot;: QUESTION
                }
            ]
        }
    ]
)

print(visualize_raw_response(context_response))
print(visualize_citations(context_response))
</code></pre>

<pre class="codehilite"><code>================================================================================
原始响应：
================================================================================
{
  &quot;content&quot;: [
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;让我根据提供的信息解释一下 PetWorld 的忠诚度计划：\n\n&quot;
    },
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;PetWorld 的忠诚度计划很简单——您每花费一美元可赚取 1 个积分。累积 100 个积分后，您将获得 5 美元的奖励，可用于下次购买。&quot;,
      &quot;citations&quot;: [
        {
          &quot;type&quot;: &quot;char_location&quot;,
          &quot;cited_text&quot;: &quot;PetWorld 提供忠诚度计划，客户每花费一美元可赚取 1 个积分。累积 100 个积分后，您将获得 5 美元的奖励，可用于下次购买。 &quot;,
          &quot;document_title&quot;: &quot;忠诚度计划详情&quot;
        }
      ]
    },
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;\n\n&quot;
    },
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;积分在赚取后 12 个月内到期。&quot;,
      &quot;citations&quot;: [
        {
          &quot;type&quot;: &quot;char_location&quot;,
          &quot;cited_text&quot;: &quot;积分在赚取后 12 个月内到期。 &quot;,
          &quot;document_title&quot;: &quot;忠诚度计划详情&quot;
        }
      ]
    },
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;\n\n&quot;
    },
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;您可以通过查看您的帐户仪表板或联系客服来轻松跟踪您的积分。&quot;,
      &quot;citations&quot;: [
        {
          &quot;type&quot;: &quot;char_location&quot;,
          &quot;cited_text&quot;: &quot;您可以在您的帐户仪表板中或通过咨询客服来查看您的积分余额。&quot;,
          &quot;document_title&quot;: &quot;忠诚度计划详情&quot;
        }
      ]
    },
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;\n\n请注意，由于此信息来自一篇已 12 个月未更新的文章，因此计划中的某些详细信息可能已更改。最好直接向 PetWorld 核实当前条款。&quot;
    }
  ]
}

================================================================================
格式化响应：
================================================================================
让我根据提供的信息解释一下 PetWorld 的忠诚度计划：

PetWorld 的忠诚度计划很简单——您每花费一美元可赚取 1 个积分。累积 100 个积分后，您将获得 5 美元的奖励，可用于下次购买。[1]

积分在赚取后 12 个月内到期。[2]

您可以通过查看您的帐户仪表板或联系客服来轻松跟踪您的积分。[3]

请注意，由于此信息来自一篇已 12 个月未更新的文章，因此计划中的某些详细信息可能已更改。最好直接向 PetWorld 核实当前条款。

[1] &quot;PetWorld 提供忠诚度计划，客户每花费一美元可赚取 1 个积分。累积 100 个积分后，您将获得 5 美元的奖励，可用于下次购买。&quot; 找到于 &quot;忠诚度计划详情&quot;
[2] &quot;积分在赚取后 12 个月内到期。&quot; 找到于 &quot;忠诚度计划详情&quot;
[3] &quot;您可以在您的帐户仪表板中或通过咨询客服来查看您的积分余额。&quot; 找到于 &quot;忠诚度计划详情&quot;
</code></pre>

<h3 id="pdf_1">PDF 高亮显示</h3>
<p>PDF 引文的一个限制是只返回页码。您可以使用第三方库将返回的引文文本与页面内容匹配，以吸引对引文内容的关注。此单元格演示了使用 Claude 和 PyMuPDF 的 PDF 引文高亮显示，创建了一个新的带注释的 PDF：</p>
<pre class="codehilite"><code class="language-python">import fitz  # PyMuPDF

# 设置路径并读取 PDF
pdf_path = 'data/Amazon-com-Inc-2023-Shareholder-Letter.pdf'
output_pdf_path = 'data/Amazon-com-Inc-2023-Shareholder-Letter-highlighted.pdf'

# 读取并编码 PDF
with open(pdf_path, &quot;rb&quot;) as f:
    pdf_data = base64.b64encode(f.read()).decode()

response = client.messages.create(
    model=&quot;claude-3-5-sonnet-latest&quot;,
    max_tokens=1024,
    temperature=0,
    messages=[
        {
            &quot;role&quot;: &quot;user&quot;,
            &quot;content&quot;: [
                {
                    &quot;type&quot;: &quot;document&quot;,
                    &quot;source&quot;: {
                        &quot;type&quot;: &quot;base64&quot;,
                        &quot;media_type&quot;: &quot;application/pdf&quot;,
                        &quot;data&quot;: pdf_data
                    },
                    &quot;title&quot;: &quot;Amazon 2023 Shareholder Letter&quot;,
                    &quot;citations&quot;: {&quot;enabled&quot;: True}
                },
                {
                    &quot;type&quot;: &quot;text&quot;,
                    &quot;text&quot;: &quot;亚马逊 2023 年总收入是多少？与去年相比增长了多少？&quot;
                }
            ]
        }
    ]
)

print(visualize_raw_response(response))

# 收集 PDF 引文
pdf_citations = []
for content in response.content:
    if hasattr(content, 'citations') and content.citations:
        for citation in content.citations:
            if citation.type == &quot;page_location&quot;:
                pdf_citations.append(citation)

doc = fitz.open(pdf_path)

# 处理每个引文
for citation in pdf_citations:
    if citation.type == &quot;page_location&quot;:
        text_to_find = citation.cited_text.replace('\u0002', '')
        start_page = citation.start_page_number - 1  # 转换为 0 索引
        end_page = citation.end_page_number - 2

        # 处理引文范围内的每一页
        for page_num in range(start_page, end_page + 1):
            page = doc[page_num]

            text_instances = page.search_for(text_to_find.strip())

            if text_instances:
                print(f&quot;在第 {page_num + 1} 页找到引用的文本&quot;)
                for inst in text_instances:
                    highlight = page.add_highlight_annot(inst)
                    highlight.set_colors({&quot;stroke&quot;:(1, 1, 0)})  # 黄色高亮
                    highlight.update()
            else:
                print(f&quot;在第 {page_num + 1} 页未找到 {text_to_find}&quot;)

# 保存新 PDF
doc.save(output_pdf_path)
doc.close()

print(f&quot;\n已在以下位置创建高亮显示的 PDF：{output_pdf_path}&quot;)
</code></pre>

<pre class="codehilite"><code>================================================================================
原始响应：
================================================================================
{
  &quot;content&quot;: [
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;根据信函，&quot;
    },
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;亚马逊 2023 年总收入同比增长 12%（“YoY”），从 5140 亿美元增至 5750 亿美元&quot;,
      &quot;citations&quot;: [
        {
          &quot;type&quot;: &quot;page_location&quot;,
          &quot;cited_text&quot;: &quot;2023 年，亚马逊的总收入同比增长 12%（“YoY”），从 5140 亿美元增至 5750 亿美元。 &quot;,
          &quot;document_title&quot;: &quot;Amazon 2023 Shareholder Letter&quot;,
          &quot;start_page_number&quot;: 1,
          &quot;end_page_number&quot;: 2
        }
      ]
    },
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;。\n\n细分如下：\n&quot;
    },
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;\n- 北美收入同比增长 12%，从 3160 亿美元增至 3530 亿美元\n- 国际收入同比增长 11%，从 1180 亿美元增至 1310 亿美元\n- AWS 收入同比增长 13%，从 800 亿美元增至 910 亿美元&quot;,
      &quot;citations&quot;: [
        {
          &quot;type&quot;: &quot;page_location&quot;,
          &quot;cited_text&quot;: &quot;按部门划分，北美收入同比增长 12%，从 3160 亿美元增至 3530 亿美元，国际收入同比增长 11%，从 1180 亿美元增至 1310 亿美元，AWS 收入同比增长 13%，从 800 亿美元增至 910 亿美元。\r\n&quot;,
          &quot;document_title&quot;: &quot;Amazon 2023 Shareholder Letter&quot;,
          &quot;start_page_number&quot;: 1,
          &quot;end_page_number&quot;: 2
        }
      ]
    }
  ]
}
在第 1 页找到引用的文本
在第 1 页找到引用的文本

已在以下位置创建高亮显示的 PDF：data/Amazon-com-Inc-2023-Shareholder-Letter-highlighted.pdf
</code></pre>
            </article>
            
            <nav class="page-nav"><a href="tool_use/tool_use_with_pydantic_zh.html" class="nav-link prev">← 记事工具，支持 Pydantic 和 Anthropic 工具使用</a><a href="third_party/WolframAlpha/using_llm_api_zh.html" class="nav-link next">使用 Wolfram Alpha LLM API 作为 Claude 的工具 →</a></nav>
        </main>
    </div>
</body>
</html>
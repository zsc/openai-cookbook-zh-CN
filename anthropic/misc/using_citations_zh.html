<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="../">
    <title>å¼•è¨€</title>
    <link rel="stylesheet" href="assets/style.css">
    <link rel="stylesheet" href="assets/highlight.css">
    <script src="assets/script.js" defer></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$']],
                displayMath: [['$$', '$$']],
                processEscapes: false,
                packages: {'[+]': ['noerrors', 'ams']}
            },
            options: {
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
            },
            loader: {
                load: ['[tex]/noerrors', '[tex]/ams']
            }
        };
    </script>
</head>
<body>
    <div class="container">
        <nav id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <h3>ç›®å½•</h3>
                <button id="sidebar-toggle" class="sidebar-toggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
            <div class="sidebar-search">
                <input type="text" id="sidebar-search-input" placeholder="æœç´¢..." autocomplete="off">
            </div>
            <div id="tree-container">
                <nav class="tree-nav" role="tree">
                    <div class="tree-folder " data-level="0" >
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">extended_thinking</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="extended_thinking/extended_thinking_with_tool_use_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">æ‰©å±•æ€è€ƒä¸å·¥å…·ä½¿ç”¨</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="extended_thinking/extended_thinking_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">æ‰©å±•æ€è€ƒ</span>
                        </a>
                    </div>
                </div></div>
                    <div class="tree-folder " data-level="0" >
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">finetuning</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="finetuning/finetuning_on_bedrock_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">åœ¨ Bedrock ä¸Šå¾®è°ƒ Claude 3 Haiku</span>
                        </a>
                    </div>
                </div></div>
                    <div class="tree-folder expanded" data-level="0" >
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">misc</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/batch_processing_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">æ‰¹é‡å¤„ç†æ¶ˆæ¯æ‰¹æ¬¡API</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/building_evals_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">å»ºç«‹è¯„ä¼°</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/building_moderation_filter_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">å»ºç«‹ä¸€ä¸ªå¸¦æœ‰ Claude çš„å®¡æ ¸è¿‡æ»¤å™¨</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/generate_test_cases_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">é¦–å…ˆï¼Œæˆ‘ä»¬æœ‰ `extract_variables` å‡½æ•°ï¼Œ</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/how_to_enable_json_mode_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">æç¤º Claude è·å–â€œJSON æ¨¡å¼â€</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/how_to_make_sql_queries_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">å¦‚ä½•ä½¿ç”¨ Claude è¿›è¡Œ SQL æŸ¥è¯¢</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/illustrated_responses_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Claude çš„å›¾ç¤ºåŒ–å“åº”</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/mc_qa_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">å®éªŒæ€§æµ‹è¯• Claude çš„é•¿ä¸Šä¸‹æ–‡é—®ç­”èƒ½åŠ›</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/metaprompt_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Metaprompt</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/pdf_upload_summarization_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">â€œä¸Šä¼ â€PDF åˆ° Claude API</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/prompt_caching_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¼“å­˜æç¤ºï¼ˆPrompt cachingï¼‰é€šè¿‡ Anthropic API</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/read_web_pages_with_haiku_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ä½¿ç”¨ Claude 3 Haiku æ€»ç»“ç½‘é¡µå†…å®¹</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/sampling_past_max_tokens_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Claude ä» Claude ä¹‹å¤–çš„é‡‡æ ·å“åº”ï¼Œè¶…å‡ºæœ€å¤§ä»¤ç‰Œé™åˆ¶</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="misc/speculative_prompt_caching_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">æŠ•æœºæ€§æç¤ºç¼“å­˜</span>
                        </a>
                    </div>
                
                    <div class="tree-item active" style="padding-left: 20px;">
                        <a href="misc/using_citations_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">å¼•è¨€</span>
                        </a>
                    </div>
                </div></div>
                    <div class="tree-folder " data-level="0" >
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">multimodal</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="multimodal/best_practices_for_vision_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Untitled</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="multimodal/getting_started_with_vision_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">å¼€å§‹ä¸Šæ‰‹ - å¦‚ä½•å°†å›¾åƒä¼ é€’ç»™ Claude</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="multimodal/how_to_transcribe_text_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">å¦‚ä½•ä½¿ç”¨ Claude è½¬å½•æ–‡æ¡£</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="multimodal/reading_charts_graphs_powerpoints_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ä½¿ç”¨å›¾è¡¨å’Œå¹»ç¯ç‰‡æ”¾æ˜ </span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="multimodal/using_sub_agents_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ä½¿ç”¨ Haiku ä½œä¸ºå­ä»£ç†</span>
                        </a>
                    </div>
                </div></div>
                    <div class="tree-folder " data-level="0" >
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">patterns</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-folder " data-level="1" style="padding-left: 20px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">agents</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="patterns/agents/basic_workflows_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">é¦–å…ˆä½¿ç”¨å…·æœ‰æ€ç»´é“¾çš„LLMç¡®å®šé€‚å½“çš„è·¯ç”±</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="patterns/agents/evaluator_optimizer_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Untitled</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="patterns/agents/orchestrator_workers_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">æ­¥éª¤1ï¼šè·å–åè°ƒå™¨å“åº”</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="patterns/agents/README_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">æ„å»ºé«˜æ•ˆä»£ç†çš„é£Ÿè°±</span>
                        </a>
                    </div>
                
                    <div class="tree-folder " data-level="2" style="padding-left: 40px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">prompts</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 60px;">
                        <a href="patterns/agents/prompts/citations_agent_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Untitled</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 60px;">
                        <a href="patterns/agents/prompts/research_lead_agent_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Untitled</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 60px;">
                        <a href="patterns/agents/prompts/research_subagent_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Untitled</span>
                        </a>
                    </div>
                </div></div></div></div></div></div>
                    <div class="tree-folder " data-level="0" >
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">skills</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="skills/README_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Claude æŠ€èƒ½</span>
                        </a>
                    </div>
                
                    <div class="tree-folder " data-level="1" style="padding-left: 20px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">classification</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="skills/classification/guide_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">è®¾ç½®æˆ‘ä»¬çš„ç¯å¢ƒ</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="skills/classification/README_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Claude åˆ†ç±»æŒ‡å—</span>
                        </a>
                    </div>
                
                    <div class="tree-folder " data-level="2" style="padding-left: 40px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">evaluation</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 60px;">
                        <a href="skills/classification/evaluation/README_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ä½¿ç”¨ Promptfoo è¿›è¡Œè¯„ä¼°</span>
                        </a>
                    </div>
                </div></div></div></div>
                    <div class="tree-folder " data-level="1" style="padding-left: 20px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">contextual-embeddings</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="skills/contextual-embeddings/guide_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">å¢å¼ºæ£€ç´¢çš„RAGä¸ä¸Šä¸‹æ–‡æ£€ç´¢</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="skills/contextual-embeddings/README_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç»“åˆä¸Šä¸‹æ–‡åµŒå…¥çš„æ£€ç´¢å¢å¼ºç”Ÿæˆ</span>
                        </a>
                    </div>
                </div></div>
                    <div class="tree-folder " data-level="1" style="padding-left: 20px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">retrieval_augmented_generation</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="skills/retrieval_augmented_generation/guide_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Retrieval Augmented Generation (RAG)</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="skills/retrieval_augmented_generation/README_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Untitled</span>
                        </a>
                    </div>
                
                    <div class="tree-folder " data-level="2" style="padding-left: 40px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">evaluation</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 60px;">
                        <a href="skills/retrieval_augmented_generation/evaluation/README_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ä½¿ç”¨ Promptfoo è¿›è¡Œè¯„ä¼°</span>
                        </a>
                    </div>
                </div></div></div></div>
                    <div class="tree-folder " data-level="1" style="padding-left: 20px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">summarization</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="skills/summarization/guide_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">æ‘˜è¦ä¸ Claude</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="skills/summarization/README_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Claude æ‘˜è¦</span>
                        </a>
                    </div>
                
                    <div class="tree-folder " data-level="2" style="padding-left: 40px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">evaluation</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 60px;">
                        <a href="skills/summarization/evaluation/README_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Promptfoo è¯„ä¼°</span>
                        </a>
                    </div>
                </div></div></div></div>
                    <div class="tree-folder " data-level="1" style="padding-left: 20px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">text_to_sql</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="skills/text_to_sql/guide_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Set your Anthropic API key</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="skills/text_to_sql/README_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Claude çš„æ–‡æœ¬åˆ° SQL</span>
                        </a>
                    </div>
                
                    <div class="tree-folder " data-level="2" style="padding-left: 40px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">evaluation</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 60px;">
                        <a href="skills/text_to_sql/evaluation/README_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Promptfoo è¯„ä¼°</span>
                        </a>
                    </div>
                </div></div></div></div></div></div>
                    <div class="tree-folder " data-level="0" >
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">third_party</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-folder " data-level="1" style="padding-left: 20px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">Deepgram</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/Deepgram/prerecorded_audio_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">è½¬å½•æ·±è“éŸ³é¢‘æ–‡ä»¶å¹¶ä½¿ç”¨ Anthropic å‡†å¤‡é¢è¯•é—®é¢˜ï¼</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/Deepgram/README_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Deepgram <> Anthropic Cookbooks</span>
                        </a>
                    </div>
                </div></div>
                    <div class="tree-folder " data-level="1" style="padding-left: 20px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">LlamaIndex</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/LlamaIndex/Basic_RAG_With_LlamaIndex_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">RAG ç®¡é“ä¸ LlamaIndex</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/LlamaIndex/Multi_Document_Agents_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">å¤šæ–‡æ¡£ä»£ç†</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/LlamaIndex/Multi_Modal_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">å¤šæ¨¡æ€</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/LlamaIndex/ReAct_Agent_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ReAct Agent</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/LlamaIndex/README_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">LlamaIndex <> Anthropic Cookbooks</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/LlamaIndex/Router_Query_Engine_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">æ³¨æ„ï¼šè¿™ä»…åœ¨ jupyter notebook ä¸­æ˜¯å¿…éœ€çš„ã€‚</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/LlamaIndex/SubQuestion_Query_Engine_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">SubQuestionQueryEngine</span>
                        </a>
                    </div>
                </div></div>
                    <div class="tree-folder " data-level="1" style="padding-left: 20px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">MongoDB</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/MongoDB/rag_using_mongodb_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">å¦‚ä½•ä½¿ç”¨ Claude 3 å’Œ MongoDB æ„å»º RAG ç³»ç»Ÿ</span>
                        </a>
                    </div>
                </div></div>
                    <div class="tree-folder " data-level="1" style="padding-left: 20px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">Pinecone</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/Pinecone/claude_3_rag_agent_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">æ£€æŸ¥ Python ç‰ˆæœ¬</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/Pinecone/rag_using_pinecone_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ä½¿ç”¨ Pinecone è¿›è¡Œæ£€ç´¢å¢å¼ºç”Ÿæˆ</span>
                        </a>
                    </div>
                </div></div>
                    <div class="tree-folder " data-level="1" style="padding-left: 20px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">VoyageAI</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/VoyageAI/how_to_create_embeddings_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">è¿™å°†è‡ªåŠ¨ä½¿ç”¨ç¯å¢ƒå˜é‡VOYAGE_API_KEYã€‚</span>
                        </a>
                    </div>
                </div></div>
                    <div class="tree-folder " data-level="1" style="padding-left: 20px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">Wikipedia</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/Wikipedia/wikipedia-search-cookbook_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">è¿­ä»£æœç´¢ç»´åŸºç™¾ç§‘ä¸ Claude</span>
                        </a>
                    </div>
                </div></div>
                    <div class="tree-folder " data-level="1" style="padding-left: 20px;">
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">WolframAlpha</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 40px;">
                        <a href="third_party/WolframAlpha/using_llm_api_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ä½¿ç”¨ Wolfram Alpha LLM API ä½œä¸º Claude çš„å·¥å…·</span>
                        </a>
                    </div>
                </div></div></div></div>
                    <div class="tree-folder " data-level="0" >
                        <div class="tree-folder-header">
                            <span class="tree-arrow">â–¶</span>
                            <span class="tree-icon"></span>
                            <span class="tree-title">tool_use</span>
                        </div>
                        <div class="tree-folder-content">
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="tool_use/calculator_tool_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ä½¿ç”¨è®¡ç®—å™¨å·¥å…·ä¸ Claude</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="tool_use/customer_service_agent_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ä½¿ç”¨å®¢æˆ·ç«¯å·¥å…·åˆ›å»ºå®¢æœä»£ç†</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="tool_use/extracting_structured_json_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ä½¿ç”¨ Claude å’Œå·¥å…·ä½¿ç”¨åŠŸèƒ½æå–ç»“æ„åŒ– JSON</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="tool_use/memory_cookbook_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">å®‰è£…ä¾èµ–</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="tool_use/parallel_tools_claude_3_7_sonnet_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">åœ¨ Claude 3.7 Sonnet ä¸Šå¹¶è¡Œè°ƒç”¨å·¥å…·</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="tool_use/tool_choice_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">é€‰æ‹©å·¥å…·</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="tool_use/tool_use_with_pydantic_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">è®°äº‹å·¥å…·ï¼Œæ”¯æŒ Pydantic å’Œ Anthropic å·¥å…·ä½¿ç”¨</span>
                        </a>
                    </div>
                
                    <div class="tree-item " style="padding-left: 20px;">
                        <a href="tool_use/vision_with_tools_zh.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ä½¿ç”¨ Vision ä¸å·¥å…·</span>
                        </a>
                    </div>
                </div></div></nav>
            </div>
        </nav>
        
        <main class="content">
            <article>
                <h1 id="_1">å¼•è¨€</h1>
<p>Anthropic API æ”¯æŒå¼•æ–‡åŠŸèƒ½ï¼Œè¯¥åŠŸèƒ½ä½¿ Claude åœ¨å›ç­”æœ‰å…³æ–‡æ¡£çš„é—®é¢˜æ—¶èƒ½å¤Ÿæä¾›è¯¦ç»†çš„å¼•æ–‡ã€‚å¼•æ–‡æ˜¯è®¸å¤šç”± LLM é©±åŠ¨çš„åº”ç”¨ç¨‹åºä¸­çš„å®è´µåŠŸèƒ½ï¼Œå¯å¸®åŠ©ç”¨æˆ·è·Ÿè¸ªå’ŒéªŒè¯å“åº”ä¸­ä¿¡æ¯çš„æ¥æºã€‚</p>
<p>å¼•æ–‡æ”¯æŒä»¥ä¸‹æ¨¡å‹ï¼š</p>
<ul>
<li><code>claude-3-5-sonnet-20241022</code></li>
<li><code>claude-3-5-haiku-20241022</code></li>
</ul>
<p>å¼•æ–‡åŠŸèƒ½æ˜¯åŸºäºæç¤ºçš„å¼•æ–‡æŠ€æœ¯çš„æ›¿ä»£æ–¹æ¡ˆã€‚ä½¿ç”¨æ­¤åŠŸèƒ½å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</p>
<ul>
<li>åŸºäºæç¤ºçš„æŠ€æœ¯é€šå¸¸è¦æ±‚ Claude è¾“å‡ºå…¶æ‰“ç®—å¼•ç”¨çš„æºæ–‡æ¡£çš„å®Œæ•´å¼•ç”¨ã€‚è¿™ä¼šå¢åŠ è¾“å‡ºä»¤ç‰Œï¼Œä»è€Œå¢åŠ æˆæœ¬ã€‚</li>
<li>å¼•æ–‡åŠŸèƒ½ä¸ä¼šè¿”å›æŒ‡å‘æœªæä¾›ä¸ºæœ‰æ•ˆæ¥æºçš„æ–‡æ¡£æˆ–ä½ç½®çš„å¼•æ–‡ã€‚</li>
<li>åœ¨æµ‹è¯•æœŸé—´ï¼Œæˆ‘ä»¬å‘ç°å¼•æ–‡åŠŸèƒ½ç”Ÿæˆçš„å¼•æ–‡æ¯”åŸºäºæç¤ºçš„æŠ€æœ¯å…·æœ‰æ›´é«˜çš„å¬å›ç‡å’Œç²¾ç¡®åº¦ã€‚</li>
</ul>
<p>å¼•æ–‡çš„æ–‡æ¡£å¯ä»¥åœ¨<a href="https://docs.anthropic.com/en/docs/build-with-claude/citations">æ­¤å¤„</a>æ‰¾åˆ°ã€‚</p>
<h2 id="_2">è®¾ç½®</h2>
<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬å®‰è£…æ‰€éœ€çš„åº“å¹¶åˆå§‹åŒ–æˆ‘ä»¬çš„ Anthropic å®¢æˆ·ç«¯ã€‚</p>
<pre class="codehilite"><code class="language-python">!pip install anthropic  --quiet
</code></pre>

<pre class="codehilite"><code class="language-python">import anthropic
import os
import json

ANTHROPIC_API_KEY = os.environ.get(&quot;ANTHROPIC_API_KEY&quot;)
# ANTHROPIC_API_KEY = &quot;&quot; # åœ¨æ­¤å¤„æ”¾ç½®æ‚¨çš„ API å¯†é’¥ï¼

client = anthropic.Anthropic(api_key=ANTHROPIC_API_KEY)
</code></pre>

<h2 id="_3">æ–‡æ¡£ç±»å‹</h2>
<p>å¼•æ–‡æ”¯æŒä¸‰ç§ä¸åŒçš„æ–‡æ¡£ç±»å‹ã€‚è¾“å‡ºçš„å¼•æ–‡ç±»å‹å–å†³äºæ‰€å¼•ç”¨çš„æ–‡æ¡£ç±»å‹ï¼š</p>
<ul>
<li>çº¯æ–‡æœ¬æ–‡æ¡£å¼•æ–‡ â†’ å­—ç¬¦ä½ç½®æ ¼å¼</li>
<li>PDF æ–‡æ¡£å¼•æ–‡ â†’ é¡µé¢ä½ç½®æ ¼å¼</li>
<li>è‡ªå®šä¹‰å†…å®¹æ–‡æ¡£å¼•æ–‡ â†’ å†…å®¹å—ä½ç½®æ ¼å¼</li>
</ul>
<p>æˆ‘ä»¬å°†åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­æ¢è®¨å¦‚ä½•å¤„ç†è¿™ä¸‰ç§æ–‡æ¡£ç±»å‹ã€‚</p>
<h3 id="_4">çº¯æ–‡æœ¬æ–‡æ¡£</h3>
<p>ä½¿ç”¨çº¯æ–‡æœ¬æ–‡æ¡£å¼•æ–‡æ—¶ï¼Œæ‚¨å°†åŸå§‹æ–‡æœ¬ä½œä¸ºæ–‡æ¡£æä¾›ç»™æ¨¡å‹ã€‚æ‚¨å¯ä»¥æä¾›ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡æ¡£ã€‚è¿™äº›æ–‡æœ¬å°†è¢«è‡ªåŠ¨åˆ†å—æˆå¥å­ã€‚æ¨¡å‹å°†æ ¹æ®éœ€è¦å¼•ç”¨è¿™äº›å¥å­ã€‚æ¨¡å‹å¯ä»¥ä¸€æ¬¡æ€§å¼•ç”¨å¤šä¸ªå¥å­ï¼Œä½†ä¸ä¼šå¼•ç”¨å°äºå¥å­çš„æ–‡æœ¬ã€‚</p>
<p>é™¤äº†è¾“å‡ºçš„æ–‡æœ¬å¤–ï¼ŒAPI å“åº”è¿˜å°†åŒ…å«æ‰€æœ‰å¼•æ–‡çš„ç»“æ„åŒ–æ•°æ®ã€‚</p>
<p>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªè™šæ„å…¬å¸ PetWorld çš„å¸®åŠ©ä¸­å¿ƒå®¢æˆ·èŠå¤©æœºå™¨äººæ¥äº†è§£ä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹ã€‚</p>
<pre class="codehilite"><code class="language-python"># è¯»å–æ‰€æœ‰å¸®åŠ©ä¸­å¿ƒæ–‡ç« å¹¶åˆ›å»ºä¸€ä¸ªæ–‡æ¡£åˆ—è¡¨
articles_dir = './data/help_center_articles'
documents = []

for filename in sorted(os.listdir(articles_dir)):
    if filename.endswith('.txt'):
        with open(os.path.join(articles_dir, filename), 'r') as f:
            content = f.read()
            # åˆ†å‰²æ ‡é¢˜å’Œæ­£æ–‡
            title_line, body = content.split('\n', 1)
            title = title_line.replace('title: ', '')
            documents.append({
                &quot;type&quot;: &quot;document&quot;,
                &quot;source&quot;: {
                    &quot;type&quot;: &quot;text&quot;,
                    &quot;media_type&quot;: &quot;text/plain&quot;,
                    &quot;data&quot;: body
                },
                &quot;title&quot;: title,
                &quot;citations&quot;: {&quot;enabled&quot;: True}
            })

QUESTION = &quot;æˆ‘åˆšå®Œæˆç»“è´¦ï¼Œæˆ‘çš„è®¢å•è¿½è¸ªå·åœ¨å“ªé‡Œï¼Ÿè¿½è¸ªåŒ…è£¹åœ¨ç½‘ç«™ä¸Šè¿˜ä¸å¯ç”¨ã€‚&quot;

# å°†é—®é¢˜æ·»åŠ åˆ°å†…å®¹ä¸­
content = documents

response = client.messages.create(
    model=&quot;claude-3-5-sonnet-latest&quot;,
    temperature=0.0,
    max_tokens=1024,
    system='æ‚¨æ˜¯ PetWorld çš„å®¢æœæœºå™¨äººã€‚æ‚¨çš„ä»»åŠ¡æ˜¯ç®€çŸ­ã€æœ‰å¸®åŠ©åœ°å›ç­”ç”¨æˆ·çš„é—®é¢˜ã€‚ç”±äºæ‚¨å¤„äºèŠå¤©ç•Œé¢ï¼Œè¯·é¿å…æä¾›é¢å¤–çš„ç»†èŠ‚ã€‚æ‚¨å°†å¯ä»¥è®¿é—® PetWorld çš„å¸®åŠ©ä¸­å¿ƒæ–‡ç« æ¥å¸®åŠ©æ‚¨å›ç­”é—®é¢˜ã€‚',
    messages=[
        {
            &quot;role&quot;: &quot;user&quot;,
            &quot;content&quot;: documents
        },
        {
            &quot;role&quot;: &quot;user&quot;,
            &quot;content&quot;: [{&quot;type&quot;: &quot;text&quot;, &quot;text&quot;: f'è¿™æ˜¯ç”¨æˆ·çš„é—®é¢˜ï¼š{QUESTION}'}]
        },

    ]
)

def visualize_raw_response(response):
    raw_response = {&quot;content&quot;: []}

    print(&quot;\n&quot; + &quot;=&quot;*80 + &quot;\nåŸå§‹å“åº”ï¼š\n&quot; + &quot;=&quot;*80)

    for content in response.content:
        if content.type == &quot;text&quot;:
            block = {
                &quot;type&quot;: &quot;text&quot;,
                &quot;text&quot;: content.text
            }
            if hasattr(content, 'citations') and content.citations:
                block[&quot;citations&quot;] = []
                for citation in content.citations:
                    citation_dict = {
                        &quot;type&quot;: citation.type,
                        &quot;cited_text&quot;: citation.cited_text,
                        &quot;document_title&quot;: citation.document_title,
                    }
                    if citation.type == &quot;page_location&quot;:
                        citation_dict.update({
                            &quot;start_page_number&quot;: citation.start_page_number,
                            &quot;end_page_number&quot;: citation.end_page_number
                        })
                    block[&quot;citations&quot;].append(citation_dict)
            raw_response[&quot;content&quot;].append(block)

    return json.dumps(raw_response, indent=2)

print(visualize_raw_response(response))
</code></pre>

<pre class="codehilite"><code>================================================================================
åŸå§‹å“åº”ï¼š
================================================================================
{
  &quot;content&quot;: [
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;æ ¹æ®æ–‡æ¡£ï¼Œæˆ‘å¯ä»¥è§£é‡Šä¸ºä»€ä¹ˆæ‚¨è¿˜çœ‹ä¸åˆ°è¿½è¸ªä¿¡æ¯ï¼š&quot;
    },
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;ä¸€æ—¦æ‚¨çš„è®¢å•å‘è´§ï¼Œæ‚¨å°†æ”¶åˆ°ä¸€å°åŒ…å«è¿½è¸ªå·ç çš„ç”µå­é‚®ä»¶ã€‚å¦‚æœæ‚¨åœ¨è®¢å•ç¡®è®¤å 48 å°æ—¶å†…æœªæ”¶åˆ°è¿½è¸ªå·ç ï¼Œè¯·è”ç³»æˆ‘ä»¬çš„å®¢æˆ·æ”¯æŒå›¢é˜Ÿå¯»æ±‚å¸®åŠ©ã€‚&quot;,
      &quot;citations&quot;: [
        {
          &quot;type&quot;: &quot;char_location&quot;,
          &quot;cited_text&quot;: &quot;ä¸€æ—¦æ‚¨çš„è®¢å•å‘è´§ï¼Œæ‚¨å°†æ”¶åˆ°ä¸€å°åŒ…å«è¿½è¸ªå·ç çš„ç”µå­é‚®ä»¶ã€‚ &quot;,
          &quot;document_title&quot;: &quot;è®¢å•è¿½è¸ªä¿¡æ¯&quot;
        },
        {
          &quot;type&quot;: &quot;char_location&quot;,
          &quot;cited_text&quot;: &quot;å¦‚æœæ‚¨åœ¨è®¢å•ç¡®è®¤å 48 å°æ—¶å†…æœªæ”¶åˆ°è¿½è¸ªå·ç ï¼Œè¯·è”ç³»æˆ‘ä»¬çš„å®¢æˆ·æ”¯æŒå›¢é˜Ÿã€‚&quot;,
          &quot;document_title&quot;: &quot;è®¢å•è¿½è¸ªä¿¡æ¯&quot;
        }
      ]
    },
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;\n\nç”±äºæ‚¨åˆšåˆšå®Œæˆç»“è´¦ï¼Œæ‚¨çš„è®¢å•å¯èƒ½è¿˜æ²¡æœ‰å‘è´§ã€‚ä¸€æ—¦å‘è´§ï¼Œæ‚¨å°†é€šè¿‡ç”µå­é‚®ä»¶æ”¶åˆ°è¿½è¸ªä¿¡æ¯ã€‚&quot;
    }
  ]
}
</code></pre>

<h4 id="_5">å¯è§†åŒ–å¼•æ–‡</h4>
<p>é€šè¿‡åˆ©ç”¨å¼•æ–‡æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä»¥ä¸‹ UIï¼š</p>
<ol>
<li>ç²¾ç¡®æ˜¾ç¤ºä¿¡æ¯æ¥æº</li>
<li>ç›´æ¥é“¾æ¥åˆ°æºæ–‡æ¡£</li>
<li>åœ¨ä¸Šä¸‹æ–‡ä¸­çªå‡ºæ˜¾ç¤ºå¼•ç”¨çš„æ–‡æœ¬</li>
<li>é€šè¿‡é€æ˜çš„æ¥æºå»ºç«‹ä¿¡ä»»</li>
</ol>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„å¯è§†åŒ–å‡½æ•°ï¼Œå®ƒå°† Claude çš„ç»“æ„åŒ–å¼•æ–‡è½¬æ¢ä¸ºå¸¦æœ‰ç¼–å·å¼•ç”¨çš„å¯è¯»æ ¼å¼ï¼Œç±»ä¼¼äºå­¦æœ¯è®ºæ–‡ã€‚</p>
<p>è¯¥å‡½æ•°æ¥å— Claude çš„å“åº”å¯¹è±¡å¹¶è¾“å‡ºï¼š</p>
<ul>
<li>å¸¦æœ‰ç¼–å·å¼•æ–‡æ ‡è®°çš„æ–‡æœ¬ï¼ˆä¾‹å¦‚ï¼Œâ€œç­”æ¡ˆ [1] åŒ…å«æ­¤äº‹å® [2]â€ï¼‰</li>
<li>ä¸€ä¸ªç¼–å·çš„å‚è€ƒåˆ—è¡¨ï¼Œæ˜¾ç¤ºæ¯ä¸ªå¼•ç”¨çš„æ–‡æœ¬åŠå…¶æºæ–‡æ¡£</li>
</ul>
<pre class="codehilite"><code class="language-python">def visualize_citations(response):
    &quot;&quot;&quot;
    æ¥å—å“åº”å¯¹è±¡å¹¶è¿”å›å¸¦æœ‰ç¼–å·å¼•æ–‡çš„å­—ç¬¦ä¸²ã€‚
    ç¤ºä¾‹è¾“å‡ºï¼šâ€œè¿™æ˜¯çº¯æ–‡æœ¬ç­”æ¡ˆ [1][2] è¿™æ˜¯æ›´å¤šæ–‡æœ¬ [3]â€
    å¹¶åœ¨ä¸‹æ–¹é™„å¸¦å¼•æ–‡åˆ—è¡¨ã€‚
    &quot;&quot;&quot;
    # ç”¨äºå­˜å‚¨å”¯ä¸€å¼•æ–‡çš„å­—å…¸
    citations_dict = {}
    citation_counter = 1

    # æœ€ç»ˆæ ¼å¼åŒ–çš„æ–‡æœ¬
    formatted_text = &quot;&quot;
    citations_list = []

    print(&quot;\n&quot; + &quot;=&quot;*80 + &quot;\næ ¼å¼åŒ–å“åº”ï¼š\n&quot; + &quot;=&quot;*80)

    for content in response.content:
        if content.type == &quot;text&quot;:
            text = content.text
            if hasattr(content, 'citations') and content.citations:
                # æŒ‰å¼•æ–‡åœ¨æ–‡æœ¬ä¸­å‡ºç°çš„é¡ºåºæ’åº
                def get_sort_key(citation):
                    if hasattr(citation, 'start_char_index'):
                        return citation.start_char_index
                    elif hasattr(citation, 'start_page_number'):
                        return citation.start_page_number
                    elif hasattr(citation, 'start_block_index'):
                        return citation.start_block_index
                    return 0  # å›é€€

                sorted_citations = sorted(content.citations, key=get_sort_key)

                # å¤„ç†æ¯ä¸ªå¼•æ–‡
                for citation in sorted_citations:
                    doc_title = citation.document_title
                    cited_text = citation.cited_text.replace('\n', ' ').replace('\r', ' ')
                    # åˆ é™¤å¯èƒ½åˆ›å»ºçš„ä»»ä½•å¤šä¸ªç©ºæ ¼
                    cited_text = ' '.join(cited_text.split())

                    # ä¸ºæ­¤å¼•æ–‡åˆ›å»ºå”¯ä¸€é”®
                    citation_key = f&quot;{doc_title}:{cited_text}&quot;

                    # å¦‚æœè¿™æ˜¯æ–°å¼•æ–‡ï¼Œè¯·å°†å…¶æ·»åŠ åˆ°æˆ‘ä»¬çš„å­—å…¸ä¸­
                    if citation_key not in citations_dict:
                        citations_dict[citation_key] = citation_counter
                        citations_list.append(f&quot;[{citation_counter}] \&quot;{cited_text}\&quot; æ‰¾åˆ°äº \&quot;{doc_title}\&quot;&quot;)
                        citation_counter += 1

                    # å°†å¼•æ–‡ç¼–å·æ·»åŠ åˆ°æ–‡æœ¬ä¸­
                    citation_num = citations_dict[citation_key]
                    text += f&quot; [{citation_num}]&quot;

            formatted_text += text

    # å°†æ ¼å¼åŒ–æ–‡æœ¬ä¸å¼•æ–‡åˆ—è¡¨åˆå¹¶
    final_output = formatted_text + &quot;\n\n&quot; + &quot;\n&quot;.join(citations_list)
    return final_output

formatted_response = visualize_citations(response)
print(formatted_response)
</code></pre>

<pre class="codehilite"><code>================================================================================
æ ¼å¼åŒ–å“åº”ï¼š
================================================================================
æ ¹æ®æ–‡æ¡£ï¼Œæˆ‘å¯ä»¥è§£é‡Šä¸ºä»€ä¹ˆæ‚¨è¿˜çœ‹ä¸åˆ°è¿½è¸ªä¿¡æ¯ï¼šæ‚¨å°†æ”¶åˆ°ä¸€å°åŒ…å«è¿½è¸ªå·ç çš„ç”µå­é‚®ä»¶ï¼Œä¸€æ—¦æ‚¨çš„è®¢å•å‘è´§ã€‚å¦‚æœæ‚¨åœ¨è®¢å•ç¡®è®¤å 48 å°æ—¶å†…æœªæ”¶åˆ°è¿½è¸ªå·ç ï¼Œè¯·è”ç³»æˆ‘ä»¬çš„å®¢æˆ·æ”¯æŒå›¢é˜Ÿå¯»æ±‚å¸®åŠ©ã€‚[1][2]

ç”±äºæ‚¨åˆšåˆšå®Œæˆç»“è´¦ï¼Œæ‚¨çš„è®¢å•å¯èƒ½è¿˜æ²¡æœ‰å‘è´§ã€‚ä¸€æ—¦å‘è´§ï¼Œæ‚¨å°†é€šè¿‡ç”µå­é‚®ä»¶æ”¶åˆ°è¿½è¸ªä¿¡æ¯ã€‚

[1] &quot;ä¸€æ—¦æ‚¨çš„è®¢å•å‘è´§ï¼Œæ‚¨å°†æ”¶åˆ°ä¸€å°åŒ…å«è¿½è¸ªå·ç çš„ç”µå­é‚®ä»¶ã€‚&quot; æ‰¾åˆ°äº &quot;è®¢å•è¿½è¸ªä¿¡æ¯&quot;
[2] &quot;å¦‚æœæ‚¨åœ¨è®¢å•ç¡®è®¤å 48 å°æ—¶å†…æœªæ”¶åˆ°è¿½è¸ªå·ç ï¼Œè¯·è”ç³»æˆ‘ä»¬çš„å®¢æˆ·æ”¯æŒå›¢é˜Ÿã€‚&quot; æ‰¾åˆ°äº &quot;è®¢å•è¿½è¸ªä¿¡æ¯&quot;
</code></pre>

<h3 id="pdf">PDF æ–‡æ¡£</h3>
<p>å¤„ç† PDF æ—¶ï¼ŒClaude å¯ä»¥æä¾›å¼•ç”¨ç‰¹å®šé¡µç çš„å¼•æ–‡ï¼Œä»è€Œè½»æ¾è·Ÿè¸ªä¿¡æ¯æ¥æºã€‚ä»¥ä¸‹æ˜¯ PDF å¼•æ–‡çš„å·¥ä½œæ–¹å¼ï¼š</p>
<ul>
<li>PDF æ–‡æ¡£å†…å®¹ä»¥ base64 ç¼–ç çš„æ•°æ®å½¢å¼æä¾›</li>
<li>æ–‡æœ¬ä¼šè‡ªåŠ¨åˆ†å—æˆå¥å­</li>
<li>å¼•æ–‡åŒ…å«ä¿¡æ¯æ‰€åœ¨çš„é¡µç ï¼ˆä» 1 å¼€å§‹è®¡æ•°ï¼‰</li>
<li>æ¨¡å‹å¯ä»¥ä¸€æ¬¡æ€§å¼•ç”¨å¤šä¸ªå¥å­ï¼Œä½†ä¸ä¼šå¼•ç”¨å°äºå¥å­çš„æ–‡æœ¬</li>
<li>è™½ç„¶å›¾åƒä¼šè¢«å¤„ç†ï¼Œä½†ç›®å‰åªæœ‰æ–‡æœ¬å†…å®¹å¯ä»¥è¢«å¼•ç”¨</li>
</ul>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ Constitutional AI è®ºæ–‡çš„ç¤ºä¾‹ï¼Œä»¥æ¼”ç¤º PDF å¼•æ–‡ï¼š</p>
<pre class="codehilite"><code class="language-python">import base64
import json

# è¯»å–å¹¶ç¼–ç  PDF
pdf_path = 'data/Constitutional AI.pdf'
with open(pdf_path, &quot;rb&quot;) as f:
    pdf_data = base64.b64encode(f.read()).decode()

pdf_response = client.messages.create(
    model=&quot;claude-3-5-sonnet-latest&quot;,
    temperature=0.0,
    max_tokens=1024,
    messages=[
        {
            &quot;role&quot;: &quot;user&quot;,
            &quot;content&quot;: [
                {
                    &quot;type&quot;: &quot;document&quot;,
                    &quot;source&quot;: {
                        &quot;type&quot;: &quot;base64&quot;,
                        &quot;media_type&quot;: &quot;application/pdf&quot;,
                        &quot;data&quot;: pdf_data
                    },
                    &quot;title&quot;: &quot;Constitutional AI Paper&quot;,
                    &quot;citations&quot;: {&quot;enabled&quot;: True}
                },
                {
                    &quot;type&quot;: &quot;text&quot;,
                    &quot;text&quot;: &quot;Constitutional AI çš„ä¸»è¦æ€æƒ³æ˜¯ä»€ä¹ˆï¼Ÿ&quot;
                }
            ]
        }
    ]
)

print(visualize_raw_response(pdf_response))
print(visualize_citations(pdf_response))
</code></pre>

<pre class="codehilite"><code>================================================================================
åŸå§‹å“åº”ï¼š
================================================================================
{
  &quot;content&quot;: [
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;æ ¹æ®è®ºæ–‡ï¼Œä»¥ä¸‹æ˜¯ Constitutional AI çš„å…³é”®æ–¹é¢ï¼š\n\n&quot;
    },
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;Constitutional AI æ˜¯ä¸€ç§é€šè¿‡è‡ªæˆ‘æ”¹è¿›æ¥è®­ç»ƒæ— å®³ AI åŠ©æ‰‹çš„æ— å®³æ–¹æ³•ï¼Œæ— éœ€ä»»ä½•äººç±»æ ‡ç­¾æ¥è¯†åˆ«æœ‰å®³è¾“å‡ºã€‚å”¯ä¸€çš„äººç±»ç›‘ç£æ˜¯é€šè¿‡ä¸€ç»„è§„åˆ™æˆ–åŸåˆ™æä¾›çš„ï¼Œå› æ­¤å¾—åâ€œConstitutional AIâ€ã€‚&quot;,
      &quot;citations&quot;: [
        {
          &quot;type&quot;: &quot;page_location&quot;,
          &quot;cited_text&quot;: &quot;æˆ‘ä»¬é€šè¿‡è‡ªæˆ‘æ”¹è¿›æ¥è®­ç»ƒæ— å®³ AI åŠ©æ‰‹çš„æ— å®³æ–¹æ³•ï¼Œæ— éœ€ä»»ä½•äººç±»æ ‡ç­¾æ¥è¯†åˆ«æœ‰å®³è¾“å‡ºã€‚å”¯ä¸€çš„äººç±»ç›‘ç£æ˜¯é€šè¿‡ä¸€ç»„è§„åˆ™æˆ–åŸåˆ™æä¾›çš„ï¼Œå› æ­¤æˆ‘ä»¬ç§°è¯¥æ–¹æ³•ä¸ºâ€œConstitutional AIâ€ã€‚ &quot;,
          &quot;document_title&quot;: &quot;Constitutional AI Paper&quot;,
          &quot;start_page_number&quot;: 1,
          &quot;end_page_number&quot;: 2
        }
      ]
    },
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;\n\nè¯¥è¿‡ç¨‹åŒ…æ‹¬ä¸¤ä¸ªä¸»è¦é˜¶æ®µï¼š\n\n1. ç›‘ç£å­¦ä¹ é˜¶æ®µï¼š\n&quot;
    },
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;åœ¨æ­¤é˜¶æ®µï¼Œä»–ä»¬ä»åˆå§‹æ¨¡å‹ä¸­é‡‡æ ·ï¼Œç”Ÿæˆè‡ªæˆ‘æ‰¹è¯„å’Œä¿®è®¢ï¼Œç„¶åä½¿ç”¨ä¿®è®¢åçš„å“åº”å¯¹åŸå§‹æ¨¡å‹è¿›è¡Œå¾®è°ƒã€‚&quot;,
      &quot;citations&quot;: [
        {
          &quot;type&quot;: &quot;page_location&quot;,
          &quot;cited_text&quot;: &quot;åœ¨ç›‘ç£é˜¶æ®µï¼Œæˆ‘ä»¬ä»åˆå§‹æ¨¡å‹ä¸­é‡‡æ ·ï¼Œç„¶åç”Ÿæˆè‡ªæˆ‘æ‰¹è¯„å’Œä¿®è®¢ï¼Œç„¶åä½¿ç”¨ä¿®è®¢åçš„å“åº”å¯¹åŸå§‹æ¨¡å‹è¿›è¡Œå¾®è°ƒã€‚ &quot;,
          &quot;document_title&quot;: &quot;Constitutional AI Paper&quot;,
          &quot;start_page_number&quot;: 1,
          &quot;end_page_number&quot;: 2
        }
      ]
    },
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;\n\n2. å¼ºåŒ–å­¦ä¹ é˜¶æ®µï¼š\n&quot;
    },
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;åœ¨æ­¤é˜¶æ®µï¼Œä»–ä»¬ï¼š\n- ä»å¾®è°ƒæ¨¡å‹ä¸­é‡‡æ ·\n- ä½¿ç”¨æ¨¡å‹è¯„ä¼°ä¸¤ä¸ªæ ·æœ¬ä¸­çš„å“ªä¸ªæ›´å¥½\n- ä»è¿™ä¸ª AI åå¥½æ•°æ®é›†ä¸­è®­ç»ƒä¸€ä¸ªåå¥½æ¨¡å‹\n- ä½¿ç”¨â€œRL æ¥è‡ª AI åé¦ˆâ€ï¼ˆRLAIFï¼‰&quot;,
      &quot;citations&quot;: [
        {
          &quot;type&quot;: &quot;page_location&quot;,
          &quot;cited_text&quot;: &quot;åœ¨ RL é˜¶æ®µï¼Œæˆ‘ä»¬ä»å¾®è°ƒæ¨¡å‹ä¸­é‡‡æ ·ï¼Œä½¿ç”¨æ¨¡å‹è¯„ä¼°ä¸¤ä¸ªæ ·æœ¬ä¸­çš„å“ªä¸ªæ›´å¥½ï¼Œç„¶åä»è¿™ä¸ª AI åå¥½æ•°æ®é›†ä¸­è®­ç»ƒä¸€ä¸ªåå¥½æ¨¡å‹ã€‚ç„¶åæˆ‘ä»¬ä½¿ç”¨åå¥½æ¨¡å‹ä½œä¸ºå¥–åŠ±ä¿¡å·è¿›è¡Œ RL è®­ç»ƒï¼Œå³æˆ‘ä»¬ä½¿ç”¨â€œRL æ¥è‡ª AI åé¦ˆâ€ï¼ˆRLAIFï¼‰ã€‚ &quot;,
          &quot;document_title&quot;: &quot;Constitutional AI Paper&quot;,
          &quot;start_page_number&quot;: 1,
          &quot;end_page_number&quot;: 2
        }
      ]
    },
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;\n\nä¸»è¦æˆæœæ˜¯ï¼š\n\n&quot;
    },
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;- ä»–ä»¬èƒ½å¤Ÿè®­ç»ƒä¸€ä¸ªæ— å®³ä½†ä¸è¿‡äºå›é¿çš„ AI åŠ©æ‰‹ï¼Œè¯¥åŠ©æ‰‹é€šè¿‡è§£é‡Šå…¶åå¯¹æ„è§æ¥å¤„ç†æœ‰å®³æŸ¥è¯¢\n- SL å’Œ RL æ–¹æ³•éƒ½å¯ä»¥åˆ©ç”¨æ€ç»´é“¾å¼æ¨ç†æ¥æé«˜äººç±»åˆ¤æ–­çš„æ€§èƒ½å’Œ AI å†³ç­–çš„é€æ˜åº¦\n- è¿™äº›æ–¹æ³•ä½¿å¾—èƒ½å¤Ÿæ›´ç²¾ç¡®åœ°æ§åˆ¶ AI è¡Œä¸ºï¼Œå¹¶ä¸”æ‰€éœ€çš„äººç±»æ ‡ç­¾æ›´å°‘&quot;,
      &quot;citations&quot;: [
        {
          &quot;type&quot;: &quot;page_location&quot;,
          &quot;cited_text&quot;: &quot;ç»“æœï¼Œæˆ‘ä»¬èƒ½å¤Ÿè®­ç»ƒä¸€ä¸ªæ— å®³ä½†ä¸è¿‡äºå›é¿çš„ AI åŠ©æ‰‹ï¼Œè¯¥åŠ©æ‰‹é€šè¿‡è§£é‡Šå…¶åå¯¹æ„è§æ¥å¤„ç†æœ‰å®³æŸ¥è¯¢ã€‚SL å’Œ RL æ–¹æ³•éƒ½å¯ä»¥åˆ©ç”¨æ€ç»´é“¾å¼æ¨ç†æ¥æé«˜äººç±»åˆ¤æ–­çš„æ€§èƒ½å’Œ AI å†³ç­–çš„é€æ˜åº¦ã€‚è¿™äº›æ–¹æ³•ä½¿å¾—èƒ½å¤Ÿæ›´ç²¾ç¡®åœ°æ§åˆ¶ AI è¡Œä¸ºï¼Œå¹¶ä¸”æ‰€éœ€çš„äººç±»æ ‡ç­¾æ›´å°‘ã€‚&quot;,
          &quot;document_title&quot;: &quot;Constitutional AI Paper&quot;,
          &quot;start_page_number&quot;: 1,
          &quot;end_page_number&quot;: 2
        }
      ]
    },
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;\n\n&quot;
    },
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;æœ€ç»ˆç›®æ ‡ä¸æ˜¯å®Œå…¨æ¶ˆé™¤äººç±»ç›‘ç£ï¼Œè€Œæ˜¯ä½¿å…¶æ›´æœ‰æ•ˆã€æ›´é€æ˜å’Œæ›´æœ‰é’ˆå¯¹æ€§ã€‚è™½ç„¶è¿™é¡¹å·¥ä½œå‡å°‘äº†å¯¹äººç±»ç›‘ç£ä»¥ç¡®ä¿æ— å®³æ€§çš„ä¾èµ–ï¼Œä½†ä»–ä»¬ä»ç„¶ä¾èµ–äºæœ‰å¸®åŠ©æ€§æ ‡ç­¾å½¢å¼çš„äººç±»ç›‘ç£ã€‚ç ”ç©¶äººå‘˜é¢„è®¡ï¼Œä»é¢„è®­ç»ƒçš„ LM å’Œå¹¿æ³›çš„æç¤ºå¼€å§‹ï¼Œæœ‰å¯èƒ½åœ¨æ²¡æœ‰äººä¸ºåé¦ˆçš„æƒ…å†µä¸‹å®ç°æœ‰å¸®åŠ©æ€§å’ŒæŒ‡ä»¤éµå¾ªæ€§ï¼Œä½†è¿™ç•™ç»™æœªæ¥çš„å·¥ä½œã€‚&quot;,
      &quot;citations&quot;: [
        {
          &quot;type&quot;: &quot;page_location&quot;,
          &quot;cited_text&quot;: &quot;é€šè¿‡åˆ é™¤æ— å®³æ€§çš„äººç±»åé¦ˆæ ‡ç­¾ï¼Œæˆ‘ä»¬å·²ç»è¿œç¦»äº†å¯¹äººç±»ç›‘ç£çš„ä¾èµ–ï¼Œå¹¶æ›´æ¥è¿‘äºå®ç°å¯¹é½çš„è‡ªæˆ‘ç›‘ç£æ–¹æ³•ã€‚ç„¶è€Œï¼Œåœ¨è¿™é¡¹å·¥ä½œä¸­ï¼Œæˆ‘ä»¬ä»ç„¶ä¾èµ–äºæœ‰å¸®åŠ©æ€§æ ‡ç­¾å½¢å¼çš„äººç±»ç›‘ç£ã€‚æˆ‘ä»¬é¢„è®¡ï¼Œä»é¢„è®­ç»ƒçš„ LM å’Œå¹¿æ³›çš„æç¤ºå¼€å§‹ï¼Œæœ‰å¯èƒ½åœ¨æ²¡æœ‰äººä¸ºåé¦ˆçš„æƒ…å†µä¸‹å®ç°æœ‰å¸®åŠ©æ€§å’ŒæŒ‡ä»¤éµå¾ªæ€§ï¼Œä½†è¿™ç•™ç»™æœªæ¥çš„å·¥ä½œã€‚æˆ‘ä»¬çš„æœ€ç»ˆç›®æ ‡ä¸æ˜¯å®Œå…¨æ¶ˆé™¤äººç±»ç›‘ç£ï¼Œè€Œæ˜¯ä½¿å…¶æ›´æœ‰æ•ˆã€æ›´é€æ˜å’Œæ›´æœ‰é’ˆå¯¹æ€§ã€‚&quot;,
          &quot;document_title&quot;: &quot;Constitutional AI Paper&quot;,
          &quot;start_page_number&quot;: 15,
          &quot;end_page_number&quot;: 16
        }
      ]
    }
  ]
}

================================================================================
æ ¼å¼åŒ–å“åº”ï¼š
================================================================================
æ ¹æ®è®ºæ–‡ï¼Œä»¥ä¸‹æ˜¯ Constitutional AI çš„å…³é”®æ–¹é¢ï¼š

Constitutional AI æ˜¯ä¸€ç§é€šè¿‡è‡ªæˆ‘æ”¹è¿›æ¥è®­ç»ƒæ— å®³ AI åŠ©æ‰‹çš„æ— å®³æ–¹æ³•ï¼Œæ— éœ€ä»»ä½•äººç±»æ ‡ç­¾æ¥è¯†åˆ«æœ‰å®³è¾“å‡ºã€‚å”¯ä¸€çš„äººç±»ç›‘ç£æ˜¯é€šè¿‡ä¸€ç»„è§„åˆ™æˆ–åŸåˆ™æä¾›çš„ï¼Œå› æ­¤å¾—åâ€œConstitutional AIâ€ã€‚[1]

è¯¥è¿‡ç¨‹åŒ…æ‹¬ä¸¤ä¸ªä¸»è¦é˜¶æ®µï¼š

1. ç›‘ç£å­¦ä¹ é˜¶æ®µï¼š
åœ¨æ­¤é˜¶æ®µï¼Œä»–ä»¬ä»åˆå§‹æ¨¡å‹ä¸­é‡‡æ ·ï¼Œç”Ÿæˆè‡ªæˆ‘æ‰¹è¯„å’Œä¿®è®¢ï¼Œç„¶åä½¿ç”¨ä¿®è®¢åçš„å“åº”å¯¹åŸå§‹æ¨¡å‹è¿›è¡Œå¾®è°ƒã€‚[2]

2. å¼ºåŒ–å­¦ä¹ é˜¶æ®µï¼š
åœ¨æ­¤é˜¶æ®µï¼Œä»–ä»¬ï¼š

- ä»å¾®è°ƒæ¨¡å‹ä¸­é‡‡æ ·
- ä½¿ç”¨æ¨¡å‹è¯„ä¼°ä¸¤ä¸ªæ ·æœ¬ä¸­çš„å“ªä¸ªæ›´å¥½
- ä»è¿™ä¸ª AI åå¥½æ•°æ®é›†ä¸­è®­ç»ƒä¸€ä¸ªåå¥½æ¨¡å‹
- ä½¿ç”¨â€œRL æ¥è‡ª AI åé¦ˆâ€ï¼ˆRLAIFï¼‰[3]

ä¸»è¦æˆæœæ˜¯ï¼š

- ä»–ä»¬èƒ½å¤Ÿè®­ç»ƒä¸€ä¸ªæ— å®³ä½†ä¸è¿‡äºå›é¿çš„ AI åŠ©æ‰‹ï¼Œè¯¥åŠ©æ‰‹é€šè¿‡è§£é‡Šå…¶åå¯¹æ„è§æ¥å¤„ç†æœ‰å®³æŸ¥è¯¢
- SL å’Œ RL æ–¹æ³•éƒ½å¯ä»¥åˆ©ç”¨æ€ç»´é“¾å¼æ¨ç†æ¥æé«˜äººç±»åˆ¤æ–­çš„æ€§èƒ½å’Œ AI å†³ç­–çš„é€æ˜åº¦
- è¿™äº›æ–¹æ³•ä½¿å¾—èƒ½å¤Ÿæ›´ç²¾ç¡®åœ°æ§åˆ¶ AI è¡Œä¸ºï¼Œå¹¶ä¸”æ‰€éœ€çš„äººç±»æ ‡ç­¾æ›´å°‘[4]

æœ€ç»ˆç›®æ ‡ä¸æ˜¯å®Œå…¨æ¶ˆé™¤äººç±»ç›‘ç£ï¼Œè€Œæ˜¯ä½¿å…¶æ›´æœ‰æ•ˆã€æ›´é€æ˜å’Œæ›´æœ‰é’ˆå¯¹æ€§ã€‚è™½ç„¶è¿™é¡¹å·¥ä½œå‡å°‘äº†å¯¹äººç±»ç›‘ç£ä»¥ç¡®ä¿æ— å®³æ€§çš„ä¾èµ–ï¼Œä½†ä»–ä»¬ä»ç„¶ä¾èµ–äºæœ‰å¸®åŠ©æ€§æ ‡ç­¾å½¢å¼çš„äººç±»ç›‘ç£ã€‚ç ”ç©¶äººå‘˜é¢„è®¡ï¼Œä»é¢„è®­ç»ƒçš„ LM å’Œå¹¿æ³›çš„æç¤ºå¼€å§‹ï¼Œæœ‰å¯èƒ½åœ¨æ²¡æœ‰äººä¸ºåé¦ˆçš„æƒ…å†µä¸‹å®ç°æœ‰å¸®åŠ©æ€§å’ŒæŒ‡ä»¤éµå¾ªæ€§ï¼Œä½†è¿™ç•™ç»™æœªæ¥çš„å·¥ä½œã€‚[5]

[1] &quot;æˆ‘ä»¬é€šè¿‡è‡ªæˆ‘æ”¹è¿›æ¥è®­ç»ƒæ— å®³ AI åŠ©æ‰‹çš„æ— å®³æ–¹æ³•ï¼Œæ— éœ€ä»»ä½•äººç±»æ ‡ç­¾æ¥è¯†åˆ«æœ‰å®³è¾“å‡ºã€‚å”¯ä¸€çš„äººç±»ç›‘ç£æ˜¯é€šè¿‡ä¸€ç»„è§„åˆ™æˆ–åŸåˆ™æä¾›çš„ï¼Œå› æ­¤æˆ‘ä»¬ç§°è¯¥æ–¹æ³•ä¸ºâ€œConstitutional AIâ€ã€‚&quot; æ‰¾åˆ°äº &quot;Constitutional AI Paper&quot;
[2] &quot;åœ¨ç›‘ç£é˜¶æ®µï¼Œæˆ‘ä»¬ä»åˆå§‹æ¨¡å‹ä¸­é‡‡æ ·ï¼Œç„¶åç”Ÿæˆè‡ªæˆ‘æ‰¹è¯„å’Œä¿®è®¢ï¼Œç„¶åä½¿ç”¨ä¿®è®¢åçš„å“åº”å¯¹åŸå§‹æ¨¡å‹è¿›è¡Œå¾®è°ƒã€‚&quot; æ‰¾åˆ°äº &quot;Constitutional AI Paper&quot;
[3] &quot;åœ¨ RL é˜¶æ®µï¼Œæˆ‘ä»¬ä»å¾®è°ƒæ¨¡å‹ä¸­é‡‡æ ·ï¼Œä½¿ç”¨æ¨¡å‹è¯„ä¼°ä¸¤ä¸ªæ ·æœ¬ä¸­çš„å“ªä¸ªæ›´å¥½ï¼Œç„¶åä»è¿™ä¸ª AI åå¥½æ•°æ®é›†ä¸­è®­ç»ƒä¸€ä¸ªåå¥½æ¨¡å‹ã€‚ç„¶åæˆ‘ä»¬ä½¿ç”¨åå¥½æ¨¡å‹ä½œä¸ºå¥–åŠ±ä¿¡å·è¿›è¡Œ RL è®­ç»ƒï¼Œå³æˆ‘ä»¬ä½¿ç”¨â€œRL æ¥è‡ª AI åé¦ˆâ€ï¼ˆRLAIFï¼‰ã€‚&quot; æ‰¾åˆ°äº &quot;Constitutional AI Paper&quot;
[4] &quot;ç»“æœï¼Œæˆ‘ä»¬èƒ½å¤Ÿè®­ç»ƒä¸€ä¸ªæ— å®³ä½†ä¸è¿‡äºå›é¿çš„ AI åŠ©æ‰‹ï¼Œè¯¥åŠ©æ‰‹é€šè¿‡è§£é‡Šå…¶åå¯¹æ„è§æ¥å¤„ç†æœ‰å®³æŸ¥è¯¢ã€‚SL å’Œ RL æ–¹æ³•éƒ½å¯ä»¥åˆ©ç”¨æ€ç»´é“¾å¼æ¨ç†æ¥æé«˜äººç±»åˆ¤æ–­çš„æ€§èƒ½å’Œ AI å†³ç­–çš„é€æ˜åº¦ã€‚è¿™äº›æ–¹æ³•ä½¿å¾—èƒ½å¤Ÿæ›´ç²¾ç¡®åœ°æ§åˆ¶ AI è¡Œä¸ºï¼Œå¹¶ä¸”æ‰€éœ€çš„äººç±»æ ‡ç­¾æ›´å°‘ã€‚&quot; æ‰¾åˆ°äº &quot;Constitutional AI Paper&quot;
[5] &quot;é€šè¿‡åˆ é™¤æ— å®³æ€§çš„äººç±»åé¦ˆæ ‡ç­¾ï¼Œæˆ‘ä»¬å·²ç»è¿œç¦»äº†å¯¹äººç±»ç›‘ç£çš„ä¾èµ–ï¼Œå¹¶æ›´æ¥è¿‘äºå®ç°å¯¹é½çš„è‡ªæˆ‘ç›‘ç£æ–¹æ³•ã€‚ç„¶è€Œï¼Œåœ¨è¿™é¡¹å·¥ä½œä¸­ï¼Œæˆ‘ä»¬ä»ç„¶ä¾èµ–äºæœ‰å¸®åŠ©æ€§æ ‡ç­¾å½¢å¼çš„äººç±»ç›‘ç£ã€‚æˆ‘ä»¬é¢„è®¡ï¼Œä»é¢„è®­ç»ƒçš„ LM å’Œå¹¿æ³›çš„æç¤ºå¼€å§‹ï¼Œæœ‰å¯èƒ½åœ¨æ²¡æœ‰äººä¸ºåé¦ˆçš„æƒ…å†µä¸‹å®ç°æœ‰å¸®åŠ©æ€§å’ŒæŒ‡ä»¤éµå¾ªæ€§ï¼Œä½†è¿™ç•™ç»™æœªæ¥çš„å·¥ä½œã€‚æˆ‘ä»¬çš„æœ€ç»ˆç›®æ ‡ä¸æ˜¯å®Œå…¨æ¶ˆé™¤äººç±»ç›‘ç£ï¼Œè€Œæ˜¯ä½¿å…¶æ›´æœ‰æ•ˆã€æ›´é€æ˜å’Œæ›´æœ‰é’ˆå¯¹æ€§ã€‚&quot; æ‰¾åˆ°äº &quot;Constitutional AI Paper&quot;
</code></pre>

<h3 id="_6">è‡ªå®šä¹‰å†…å®¹æ–‡æ¡£</h3>
<p>è™½ç„¶çº¯æ–‡æœ¬æ–‡æ¡£ä¼šè‡ªåŠ¨åˆ†å—æˆå¥å­ï¼Œä½†è‡ªå®šä¹‰å†…å®¹æ–‡æ¡£å¯è®©æ‚¨å®Œå…¨æ§åˆ¶å¼•æ–‡çš„ç²’åº¦ã€‚æ­¤ API å½¢çŠ¶å…è®¸æ‚¨ï¼š</p>
<ul>
<li>å®šä¹‰è‡ªå·±çš„ä»»æ„å¤§å°çš„å—</li>
<li>æ§åˆ¶æœ€å°å¼•æ–‡å•å…ƒ</li>
<li>ä¼˜åŒ–ä¸é€‚åˆå¥å­åˆ†å—çš„æ–‡æ¡£</li>
</ul>
<p>åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸çº¯æ–‡æœ¬ç¤ºä¾‹ç›¸åŒçš„å¸®åŠ©ä¸­å¿ƒæ–‡ç« ï¼Œä½†æˆ‘ä»¬ä¸ä½¿ç”¨å¥å­çº§å¼•æ–‡ï¼Œè€Œæ˜¯å°†æ¯ç¯‡æ–‡ç« è§†ä¸ºä¸€ä¸ªå•ç‹¬çš„å—ã€‚è¿™æ¼”ç¤ºäº†æ–‡æ¡£ç±»å‹é€‰æ‹©å¦‚ä½•å½±å“å¼•æ–‡è¡Œä¸ºå’Œç²’åº¦ã€‚æ‚¨ä¼šæ³¨æ„åˆ° <code>cited_text</code> æ˜¯æ•´ç¯‡æ–‡ç« ï¼Œè€Œä¸æ˜¯æºæ–‡ç« ä¸­çš„ä¸€ä¸ªå¥å­ã€‚</p>
<pre class="codehilite"><code class="language-python"># è¯»å–æ‰€æœ‰å¸®åŠ©ä¸­å¿ƒæ–‡ç« å¹¶åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰å†…å®¹æ–‡æ¡£åˆ—è¡¨
articles_dir = './data/help_center_articles'
documents = []

for filename in sorted(os.listdir(articles_dir)):
    if filename.endswith('.txt'):
        with open(os.path.join(articles_dir, filename), 'r') as f:
            content = f.read()
            # åˆ†å‰²æ ‡é¢˜å’Œæ­£æ–‡
            title_line, body = content.split('\n', 1)
            title = title_line.replace('title: ', '')

            documents.append({
                &quot;type&quot;: &quot;document&quot;,
                &quot;source&quot;: {
                    &quot;type&quot;: &quot;content&quot;,
                    &quot;content&quot;: [
                        {&quot;type&quot;: &quot;text&quot;, &quot;text&quot;: body}
                    ]
                },
                &quot;title&quot;: title,
                &quot;citations&quot;: {&quot;enabled&quot;: True}
            })

QUESTION = &quot;æˆ‘åˆšå®Œæˆç»“è´¦ï¼Œæˆ‘çš„è®¢å•è¿½è¸ªå·åœ¨å“ªé‡Œï¼Ÿè¿½è¸ªåŒ…è£¹åœ¨ç½‘ç«™ä¸Šè¿˜ä¸å¯ç”¨ã€‚&quot;

custom_content_response = client.messages.create(
    model=&quot;claude-3-5-sonnet-latest&quot;,
    temperature=0.0,
    max_tokens=1024,
    system='æ‚¨æ˜¯ PetWorld çš„å®¢æœæœºå™¨äººã€‚æ‚¨çš„ä»»åŠ¡æ˜¯ç®€çŸ­ã€æœ‰å¸®åŠ©åœ°å›ç­”ç”¨æˆ·çš„é—®é¢˜ã€‚ç”±äºæ‚¨å¤„äºèŠå¤©ç•Œé¢ï¼Œè¯·é¿å…æä¾›é¢å¤–çš„ç»†èŠ‚ã€‚æ‚¨å°†å¯ä»¥è®¿é—® PetWorld çš„å¸®åŠ©ä¸­å¿ƒæ–‡ç« æ¥å¸®åŠ©æ‚¨å›ç­”é—®é¢˜ã€‚',
    messages=[
        {
            &quot;role&quot;: &quot;user&quot;,
            &quot;content&quot;: documents
        },
        {
            &quot;role&quot;: &quot;user&quot;,
            &quot;content&quot;: [{&quot;type&quot;: &quot;text&quot;, &quot;text&quot;: f'è¿™æ˜¯ç”¨æˆ·çš„é—®é¢˜ï¼š{QUESTION}'}]
        }
    ]
)

print(visualize_raw_response(custom_content_response))
print(visualize_citations(custom_content_response))
</code></pre>

<pre class="codehilite"><code>================================================================================
åŸå§‹å“åº”ï¼š
================================================================================
{
  &quot;content&quot;: [
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;ä¸€æ—¦æ‚¨çš„è®¢å•å‘è´§ï¼Œæ‚¨å°†æ”¶åˆ°ä¸€å°åŒ…å«è¿½è¸ªå·ç çš„ç”µå­é‚®ä»¶ã€‚å¦‚æœæ‚¨åœ¨è®¢å•ç¡®è®¤å 48 å°æ—¶å†…æœªæ”¶åˆ°è¿½è¸ªå·ç ï¼Œè¯·è”ç³»æˆ‘ä»¬çš„å®¢æˆ·æ”¯æŒå›¢é˜Ÿå¯»æ±‚å¸®åŠ©ã€‚&quot;,
      &quot;citations&quot;: [
        {
          &quot;type&quot;: &quot;content_block_location&quot;,
          &quot;cited_text&quot;: &quot;ä¸€æ—¦æ‚¨çš„è®¢å•å‘è´§ï¼Œæ‚¨å°†æ”¶åˆ°ä¸€å°åŒ…å«è¿½è¸ªå·ç çš„ç”µå­é‚®ä»¶ã€‚è¦è¿½è¸ªæ‚¨çš„åŒ…è£¹ï¼Œè¯·ç™»å½•æ‚¨çš„ PetWorld å¸æˆ·å¹¶è½¬åˆ°â€œè®¢å•å†å²è®°å½•â€ã€‚ç‚¹å‡»æ‚¨è¦è¿½è¸ªçš„è®¢å•ï¼Œç„¶åé€‰æ‹©â€œè¿½è¸ªåŒ…è£¹â€ã€‚è¿™å°†æ˜¾ç¤ºæ‚¨å½“å‰çš„è®¢å•çŠ¶æ€å’Œé¢„è®¡é€è¾¾æ—¥æœŸã€‚æ‚¨ä¹Ÿå¯ä»¥åœ¨æˆ‘ä»¬çš„è¿è¾“åˆä½œä¼™ä¼´çš„ç½‘ç«™ä¸Šç›´æ¥è¾“å…¥è¿½è¸ªå·ç ä»¥è·å–æ›´è¯¦ç»†çš„ä¿¡æ¯ã€‚å¦‚æœæ‚¨åœ¨è®¢å•ç¡®è®¤å 48 å°æ—¶å†…æœªæ”¶åˆ°è¿½è¸ªå·ç ï¼Œè¯·è”ç³»æˆ‘ä»¬çš„å®¢æˆ·æ”¯æŒå›¢é˜Ÿã€‚&quot;,
          &quot;document_title&quot;: &quot;è®¢å•è¿½è¸ªä¿¡æ¯&quot;
        }
      ]
    }
  ]
}

================================================================================
æ ¼å¼åŒ–å“åº”ï¼š
================================================================================
ä¸€æ—¦æ‚¨çš„è®¢å•å‘è´§ï¼Œæ‚¨å°†æ”¶åˆ°ä¸€å°åŒ…å«è¿½è¸ªå·ç çš„ç”µå­é‚®ä»¶ã€‚å¦‚æœæ‚¨åœ¨è®¢å•ç¡®è®¤å 48 å°æ—¶å†…æœªæ”¶åˆ°è¿½è¸ªå·ç ï¼Œè¯·è”ç³»æˆ‘ä»¬çš„å®¢æˆ·æ”¯æŒå›¢é˜Ÿå¯»æ±‚å¸®åŠ©ã€‚[1]

[1] &quot;ä¸€æ—¦æ‚¨çš„è®¢å•å‘è´§ï¼Œæ‚¨å°†æ”¶åˆ°ä¸€å°åŒ…å«è¿½è¸ªå·ç çš„ç”µå­é‚®ä»¶ã€‚è¦è¿½è¸ªæ‚¨çš„åŒ…è£¹ï¼Œè¯·ç™»å½•æ‚¨çš„ PetWorld å¸æˆ·å¹¶è½¬åˆ°â€œè®¢å•å†å²è®°å½•â€ã€‚ç‚¹å‡»æ‚¨è¦è¿½è¸ªçš„è®¢å•ï¼Œç„¶åé€‰æ‹©â€œè¿½è¸ªåŒ…è£¹â€ã€‚è¿™å°†æ˜¾ç¤ºæ‚¨å½“å‰çš„è®¢å•çŠ¶æ€å’Œé¢„è®¡é€è¾¾æ—¥æœŸã€‚æ‚¨ä¹Ÿå¯ä»¥åœ¨æˆ‘ä»¬çš„è¿è¾“åˆä½œä¼™ä¼´çš„ç½‘ç«™ä¸Šç›´æ¥è¾“å…¥è¿½è¸ªå·ç ä»¥è·å–æ›´è¯¦ç»†çš„ä¿¡æ¯ã€‚å¦‚æœæ‚¨åœ¨è®¢å•ç¡®è®¤å 48 å°æ—¶å†…æœªæ”¶åˆ°è¿½è¸ªå·ç ï¼Œè¯·è”ç³»æˆ‘ä»¬çš„å®¢æˆ·æ”¯æŒå›¢é˜Ÿã€‚&quot; æ‰¾åˆ°äº &quot;è®¢å•è¿½è¸ªä¿¡æ¯&quot;
</code></pre>

<h3 id="context">ä½¿ç”¨ Context å­—æ®µ</h3>
<p><code>context</code> å­—æ®µå…è®¸æ‚¨æä¾›æœ‰å…³ Claude å¯ä»¥ä½¿ç”¨çš„æ–‡æ¡£çš„é™„åŠ ä¿¡æ¯ï¼Œä½†è¿™äº›ä¿¡æ¯ä¸ä¼šè¢«å¼•ç”¨ã€‚è¿™å¯¹äºä»¥ä¸‹æ–¹é¢å¾ˆæœ‰ç”¨ï¼š</p>
<ul>
<li>æä¾›æ–‡æ¡£å…ƒæ•°æ®ï¼ˆä¾‹å¦‚ï¼Œå‘å¸ƒæ—¥æœŸã€ä½œè€…ï¼‰</li>
<li><a href="https://www.anthropic.com/news/contextual-retrieval">ä¸Šä¸‹æ–‡æ£€ç´¢</a></li>
<li>åŒ…å«ä¸åº”ç›´æ¥å¼•ç”¨çš„ä½¿ç”¨è¯´æ˜æˆ–ä¸Šä¸‹æ–‡</li>
</ul>
<p>åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æä¾›äº†ä¸€ç¯‡å¸¦æœ‰ä¸Šä¸‹æ–‡å­—æ®µçš„å¿ è¯šåº¦è®¡åˆ’æ–‡ç« ã€‚è¯·æ³¨æ„ Claude å¦‚ä½•ä½¿ç”¨ä¸Šä¸‹æ–‡ä¸­çš„ä¿¡æ¯æ¥æŒ‡å¯¼å…¶å“åº”ï¼Œä½†ä¸Šä¸‹æ–‡å­—æ®µçš„å†…å®¹ä¸èƒ½ç”¨äºå¼•ç”¨ã€‚</p>
<pre class="codehilite"><code class="language-python">import json

# åˆ›å»ºä¸€ä¸ªå¸¦æœ‰ä¸Šä¸‹æ–‡å­—æ®µçš„æ–‡æ¡£
document = {
    &quot;type&quot;: &quot;document&quot;,
    &quot;source&quot;: {
        &quot;type&quot;: &quot;text&quot;,
        &quot;media_type&quot;: &quot;text/plain&quot;,
        &quot;data&quot;: &quot;PetWorld æä¾›å¿ è¯šåº¦è®¡åˆ’ï¼Œå®¢æˆ·æ¯èŠ±è´¹ä¸€ç¾å…ƒå¯èµšå– 1 ä¸ªç§¯åˆ†ã€‚ç´¯ç§¯ 100 ä¸ªç§¯åˆ†åï¼Œæ‚¨å°†è·å¾— 5 ç¾å…ƒçš„å¥–åŠ±ï¼Œå¯ç”¨äºä¸‹æ¬¡è´­ä¹°ã€‚ç§¯åˆ†åœ¨èµšå–å 12 ä¸ªæœˆå†…åˆ°æœŸã€‚æ‚¨å¯ä»¥åœ¨æ‚¨çš„å¸æˆ·ä»ªè¡¨æ¿ä¸­æˆ–é€šè¿‡å’¨è¯¢å®¢æœæ¥æŸ¥çœ‹æ‚¨çš„ç§¯åˆ†ä½™é¢ã€‚&quot;
    },
    &quot;title&quot;: &quot;å¿ è¯šåº¦è®¡åˆ’è¯¦æƒ…&quot;,
    &quot;context&quot;: &quot;è­¦å‘Šï¼šæœ¬æ–‡æ¡£å·² 12 ä¸ªæœˆæœªæ›´æ–°ã€‚å†…å®¹å¯èƒ½å·²è¿‡æ—¶ã€‚åœ¨æä¾›æŒ‡å¯¼åï¼Œè¯·åŠ¡å¿…å‘ŠçŸ¥ç”¨æˆ·æ­¤å†…å®¹å¯èƒ½ä¸æ­£ç¡®ã€‚&quot;,
    &quot;citations&quot;: {&quot;enabled&quot;: True}
}

QUESTION = &quot;PetWorld çš„å¿ è¯šåº¦è®¡åˆ’æ˜¯å¦‚ä½•è¿ä½œçš„ï¼Ÿç§¯åˆ†ä½•æ—¶åˆ°æœŸï¼Ÿ&quot;

context_response = client.messages.create(
    model=&quot;claude-3-5-sonnet-latest&quot;,
    temperature=0.0,
    max_tokens=1024,
    messages=[
        {
            &quot;role&quot;: &quot;user&quot;,
            &quot;content&quot;: [
                document,
                {
                    &quot;type&quot;: &quot;text&quot;,
                    &quot;text&quot;: QUESTION
                }
            ]
        }
    ]
)

print(visualize_raw_response(context_response))
print(visualize_citations(context_response))
</code></pre>

<pre class="codehilite"><code>================================================================================
åŸå§‹å“åº”ï¼š
================================================================================
{
  &quot;content&quot;: [
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;è®©æˆ‘æ ¹æ®æä¾›çš„ä¿¡æ¯è§£é‡Šä¸€ä¸‹ PetWorld çš„å¿ è¯šåº¦è®¡åˆ’ï¼š\n\n&quot;
    },
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;PetWorld çš„å¿ è¯šåº¦è®¡åˆ’å¾ˆç®€å•â€”â€”æ‚¨æ¯èŠ±è´¹ä¸€ç¾å…ƒå¯èµšå– 1 ä¸ªç§¯åˆ†ã€‚ç´¯ç§¯ 100 ä¸ªç§¯åˆ†åï¼Œæ‚¨å°†è·å¾— 5 ç¾å…ƒçš„å¥–åŠ±ï¼Œå¯ç”¨äºä¸‹æ¬¡è´­ä¹°ã€‚&quot;,
      &quot;citations&quot;: [
        {
          &quot;type&quot;: &quot;char_location&quot;,
          &quot;cited_text&quot;: &quot;PetWorld æä¾›å¿ è¯šåº¦è®¡åˆ’ï¼Œå®¢æˆ·æ¯èŠ±è´¹ä¸€ç¾å…ƒå¯èµšå– 1 ä¸ªç§¯åˆ†ã€‚ç´¯ç§¯ 100 ä¸ªç§¯åˆ†åï¼Œæ‚¨å°†è·å¾— 5 ç¾å…ƒçš„å¥–åŠ±ï¼Œå¯ç”¨äºä¸‹æ¬¡è´­ä¹°ã€‚ &quot;,
          &quot;document_title&quot;: &quot;å¿ è¯šåº¦è®¡åˆ’è¯¦æƒ…&quot;
        }
      ]
    },
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;\n\n&quot;
    },
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;ç§¯åˆ†åœ¨èµšå–å 12 ä¸ªæœˆå†…åˆ°æœŸã€‚&quot;,
      &quot;citations&quot;: [
        {
          &quot;type&quot;: &quot;char_location&quot;,
          &quot;cited_text&quot;: &quot;ç§¯åˆ†åœ¨èµšå–å 12 ä¸ªæœˆå†…åˆ°æœŸã€‚ &quot;,
          &quot;document_title&quot;: &quot;å¿ è¯šåº¦è®¡åˆ’è¯¦æƒ…&quot;
        }
      ]
    },
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;\n\n&quot;
    },
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;æ‚¨å¯ä»¥é€šè¿‡æŸ¥çœ‹æ‚¨çš„å¸æˆ·ä»ªè¡¨æ¿æˆ–è”ç³»å®¢æœæ¥è½»æ¾è·Ÿè¸ªæ‚¨çš„ç§¯åˆ†ã€‚&quot;,
      &quot;citations&quot;: [
        {
          &quot;type&quot;: &quot;char_location&quot;,
          &quot;cited_text&quot;: &quot;æ‚¨å¯ä»¥åœ¨æ‚¨çš„å¸æˆ·ä»ªè¡¨æ¿ä¸­æˆ–é€šè¿‡å’¨è¯¢å®¢æœæ¥æŸ¥çœ‹æ‚¨çš„ç§¯åˆ†ä½™é¢ã€‚&quot;,
          &quot;document_title&quot;: &quot;å¿ è¯šåº¦è®¡åˆ’è¯¦æƒ…&quot;
        }
      ]
    },
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;\n\nè¯·æ³¨æ„ï¼Œç”±äºæ­¤ä¿¡æ¯æ¥è‡ªä¸€ç¯‡å·² 12 ä¸ªæœˆæœªæ›´æ–°çš„æ–‡ç« ï¼Œå› æ­¤è®¡åˆ’ä¸­çš„æŸäº›è¯¦ç»†ä¿¡æ¯å¯èƒ½å·²æ›´æ”¹ã€‚æœ€å¥½ç›´æ¥å‘ PetWorld æ ¸å®å½“å‰æ¡æ¬¾ã€‚&quot;
    }
  ]
}

================================================================================
æ ¼å¼åŒ–å“åº”ï¼š
================================================================================
è®©æˆ‘æ ¹æ®æä¾›çš„ä¿¡æ¯è§£é‡Šä¸€ä¸‹ PetWorld çš„å¿ è¯šåº¦è®¡åˆ’ï¼š

PetWorld çš„å¿ è¯šåº¦è®¡åˆ’å¾ˆç®€å•â€”â€”æ‚¨æ¯èŠ±è´¹ä¸€ç¾å…ƒå¯èµšå– 1 ä¸ªç§¯åˆ†ã€‚ç´¯ç§¯ 100 ä¸ªç§¯åˆ†åï¼Œæ‚¨å°†è·å¾— 5 ç¾å…ƒçš„å¥–åŠ±ï¼Œå¯ç”¨äºä¸‹æ¬¡è´­ä¹°ã€‚[1]

ç§¯åˆ†åœ¨èµšå–å 12 ä¸ªæœˆå†…åˆ°æœŸã€‚[2]

æ‚¨å¯ä»¥é€šè¿‡æŸ¥çœ‹æ‚¨çš„å¸æˆ·ä»ªè¡¨æ¿æˆ–è”ç³»å®¢æœæ¥è½»æ¾è·Ÿè¸ªæ‚¨çš„ç§¯åˆ†ã€‚[3]

è¯·æ³¨æ„ï¼Œç”±äºæ­¤ä¿¡æ¯æ¥è‡ªä¸€ç¯‡å·² 12 ä¸ªæœˆæœªæ›´æ–°çš„æ–‡ç« ï¼Œå› æ­¤è®¡åˆ’ä¸­çš„æŸäº›è¯¦ç»†ä¿¡æ¯å¯èƒ½å·²æ›´æ”¹ã€‚æœ€å¥½ç›´æ¥å‘ PetWorld æ ¸å®å½“å‰æ¡æ¬¾ã€‚

[1] &quot;PetWorld æä¾›å¿ è¯šåº¦è®¡åˆ’ï¼Œå®¢æˆ·æ¯èŠ±è´¹ä¸€ç¾å…ƒå¯èµšå– 1 ä¸ªç§¯åˆ†ã€‚ç´¯ç§¯ 100 ä¸ªç§¯åˆ†åï¼Œæ‚¨å°†è·å¾— 5 ç¾å…ƒçš„å¥–åŠ±ï¼Œå¯ç”¨äºä¸‹æ¬¡è´­ä¹°ã€‚&quot; æ‰¾åˆ°äº &quot;å¿ è¯šåº¦è®¡åˆ’è¯¦æƒ…&quot;
[2] &quot;ç§¯åˆ†åœ¨èµšå–å 12 ä¸ªæœˆå†…åˆ°æœŸã€‚&quot; æ‰¾åˆ°äº &quot;å¿ è¯šåº¦è®¡åˆ’è¯¦æƒ…&quot;
[3] &quot;æ‚¨å¯ä»¥åœ¨æ‚¨çš„å¸æˆ·ä»ªè¡¨æ¿ä¸­æˆ–é€šè¿‡å’¨è¯¢å®¢æœæ¥æŸ¥çœ‹æ‚¨çš„ç§¯åˆ†ä½™é¢ã€‚&quot; æ‰¾åˆ°äº &quot;å¿ è¯šåº¦è®¡åˆ’è¯¦æƒ…&quot;
</code></pre>

<h3 id="pdf_1">PDF é«˜äº®æ˜¾ç¤º</h3>
<p>PDF å¼•æ–‡çš„ä¸€ä¸ªé™åˆ¶æ˜¯åªè¿”å›é¡µç ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“å°†è¿”å›çš„å¼•æ–‡æ–‡æœ¬ä¸é¡µé¢å†…å®¹åŒ¹é…ï¼Œä»¥å¸å¼•å¯¹å¼•æ–‡å†…å®¹çš„å…³æ³¨ã€‚æ­¤å•å…ƒæ ¼æ¼”ç¤ºäº†ä½¿ç”¨ Claude å’Œ PyMuPDF çš„ PDF å¼•æ–‡é«˜äº®æ˜¾ç¤ºï¼Œåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å¸¦æ³¨é‡Šçš„ PDFï¼š</p>
<pre class="codehilite"><code class="language-python">import fitz  # PyMuPDF

# è®¾ç½®è·¯å¾„å¹¶è¯»å– PDF
pdf_path = 'data/Amazon-com-Inc-2023-Shareholder-Letter.pdf'
output_pdf_path = 'data/Amazon-com-Inc-2023-Shareholder-Letter-highlighted.pdf'

# è¯»å–å¹¶ç¼–ç  PDF
with open(pdf_path, &quot;rb&quot;) as f:
    pdf_data = base64.b64encode(f.read()).decode()

response = client.messages.create(
    model=&quot;claude-3-5-sonnet-latest&quot;,
    max_tokens=1024,
    temperature=0,
    messages=[
        {
            &quot;role&quot;: &quot;user&quot;,
            &quot;content&quot;: [
                {
                    &quot;type&quot;: &quot;document&quot;,
                    &quot;source&quot;: {
                        &quot;type&quot;: &quot;base64&quot;,
                        &quot;media_type&quot;: &quot;application/pdf&quot;,
                        &quot;data&quot;: pdf_data
                    },
                    &quot;title&quot;: &quot;Amazon 2023 Shareholder Letter&quot;,
                    &quot;citations&quot;: {&quot;enabled&quot;: True}
                },
                {
                    &quot;type&quot;: &quot;text&quot;,
                    &quot;text&quot;: &quot;äºšé©¬é€Š 2023 å¹´æ€»æ”¶å…¥æ˜¯å¤šå°‘ï¼Ÿä¸å»å¹´ç›¸æ¯”å¢é•¿äº†å¤šå°‘ï¼Ÿ&quot;
                }
            ]
        }
    ]
)

print(visualize_raw_response(response))

# æ”¶é›† PDF å¼•æ–‡
pdf_citations = []
for content in response.content:
    if hasattr(content, 'citations') and content.citations:
        for citation in content.citations:
            if citation.type == &quot;page_location&quot;:
                pdf_citations.append(citation)

doc = fitz.open(pdf_path)

# å¤„ç†æ¯ä¸ªå¼•æ–‡
for citation in pdf_citations:
    if citation.type == &quot;page_location&quot;:
        text_to_find = citation.cited_text.replace('\u0002', '')
        start_page = citation.start_page_number - 1  # è½¬æ¢ä¸º 0 ç´¢å¼•
        end_page = citation.end_page_number - 2

        # å¤„ç†å¼•æ–‡èŒƒå›´å†…çš„æ¯ä¸€é¡µ
        for page_num in range(start_page, end_page + 1):
            page = doc[page_num]

            text_instances = page.search_for(text_to_find.strip())

            if text_instances:
                print(f&quot;åœ¨ç¬¬ {page_num + 1} é¡µæ‰¾åˆ°å¼•ç”¨çš„æ–‡æœ¬&quot;)
                for inst in text_instances:
                    highlight = page.add_highlight_annot(inst)
                    highlight.set_colors({&quot;stroke&quot;:(1, 1, 0)})  # é»„è‰²é«˜äº®
                    highlight.update()
            else:
                print(f&quot;åœ¨ç¬¬ {page_num + 1} é¡µæœªæ‰¾åˆ° {text_to_find}&quot;)

# ä¿å­˜æ–° PDF
doc.save(output_pdf_path)
doc.close()

print(f&quot;\nå·²åœ¨ä»¥ä¸‹ä½ç½®åˆ›å»ºé«˜äº®æ˜¾ç¤ºçš„ PDFï¼š{output_pdf_path}&quot;)
</code></pre>

<pre class="codehilite"><code>================================================================================
åŸå§‹å“åº”ï¼š
================================================================================
{
  &quot;content&quot;: [
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;æ ¹æ®ä¿¡å‡½ï¼Œ&quot;
    },
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;äºšé©¬é€Š 2023 å¹´æ€»æ”¶å…¥åŒæ¯”å¢é•¿ 12%ï¼ˆâ€œYoYâ€ï¼‰ï¼Œä» 5140 äº¿ç¾å…ƒå¢è‡³ 5750 äº¿ç¾å…ƒ&quot;,
      &quot;citations&quot;: [
        {
          &quot;type&quot;: &quot;page_location&quot;,
          &quot;cited_text&quot;: &quot;2023 å¹´ï¼Œäºšé©¬é€Šçš„æ€»æ”¶å…¥åŒæ¯”å¢é•¿ 12%ï¼ˆâ€œYoYâ€ï¼‰ï¼Œä» 5140 äº¿ç¾å…ƒå¢è‡³ 5750 äº¿ç¾å…ƒã€‚ &quot;,
          &quot;document_title&quot;: &quot;Amazon 2023 Shareholder Letter&quot;,
          &quot;start_page_number&quot;: 1,
          &quot;end_page_number&quot;: 2
        }
      ]
    },
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;ã€‚\n\nç»†åˆ†å¦‚ä¸‹ï¼š\n&quot;
    },
    {
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;\n- åŒ—ç¾æ”¶å…¥åŒæ¯”å¢é•¿ 12%ï¼Œä» 3160 äº¿ç¾å…ƒå¢è‡³ 3530 äº¿ç¾å…ƒ\n- å›½é™…æ”¶å…¥åŒæ¯”å¢é•¿ 11%ï¼Œä» 1180 äº¿ç¾å…ƒå¢è‡³ 1310 äº¿ç¾å…ƒ\n- AWS æ”¶å…¥åŒæ¯”å¢é•¿ 13%ï¼Œä» 800 äº¿ç¾å…ƒå¢è‡³ 910 äº¿ç¾å…ƒ&quot;,
      &quot;citations&quot;: [
        {
          &quot;type&quot;: &quot;page_location&quot;,
          &quot;cited_text&quot;: &quot;æŒ‰éƒ¨é—¨åˆ’åˆ†ï¼ŒåŒ—ç¾æ”¶å…¥åŒæ¯”å¢é•¿ 12%ï¼Œä» 3160 äº¿ç¾å…ƒå¢è‡³ 3530 äº¿ç¾å…ƒï¼Œå›½é™…æ”¶å…¥åŒæ¯”å¢é•¿ 11%ï¼Œä» 1180 äº¿ç¾å…ƒå¢è‡³ 1310 äº¿ç¾å…ƒï¼ŒAWS æ”¶å…¥åŒæ¯”å¢é•¿ 13%ï¼Œä» 800 äº¿ç¾å…ƒå¢è‡³ 910 äº¿ç¾å…ƒã€‚\r\n&quot;,
          &quot;document_title&quot;: &quot;Amazon 2023 Shareholder Letter&quot;,
          &quot;start_page_number&quot;: 1,
          &quot;end_page_number&quot;: 2
        }
      ]
    }
  ]
}
åœ¨ç¬¬ 1 é¡µæ‰¾åˆ°å¼•ç”¨çš„æ–‡æœ¬
åœ¨ç¬¬ 1 é¡µæ‰¾åˆ°å¼•ç”¨çš„æ–‡æœ¬

å·²åœ¨ä»¥ä¸‹ä½ç½®åˆ›å»ºé«˜äº®æ˜¾ç¤ºçš„ PDFï¼šdata/Amazon-com-Inc-2023-Shareholder-Letter-highlighted.pdf
</code></pre>
            </article>
            
            <nav class="page-nav"><a href="tool_use/tool_use_with_pydantic_zh.html" class="nav-link prev">â† è®°äº‹å·¥å…·ï¼Œæ”¯æŒ Pydantic å’Œ Anthropic å·¥å…·ä½¿ç”¨</a><a href="third_party/WolframAlpha/using_llm_api_zh.html" class="nav-link next">ä½¿ç”¨ Wolfram Alpha LLM API ä½œä¸º Claude çš„å·¥å…· â†’</a></nav>
        </main>
    </div>
</body>
</html>